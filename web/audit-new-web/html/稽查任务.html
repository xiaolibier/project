<!doctype html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<meta content="IE=Edge,chrome=1" http-equiv="X-UA-Compatible">
	<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
	<meta content="yes" name="apple-mobile-web-app-capable">
	<meta content="black" name="apple-mobile-web-app-status-bar-style">
	<meta name="format-detection" content="telephone=no"/>
	<link rel="stylesheet" href="../public/css/pagination.css" />
	<link rel="stylesheet" href="../public/css/common.css" />
	<link rel="stylesheet" href="../public/btncss/normalize.css" />
	<link rel="stylesheet" href="../public/btncss/vicons-font.css" />
	<!-- <link rel="stylesheet" href="../public/btncss/base.css" /> -->
	<link rel="stylesheet" href="../public/btncss/buttons.css" />
	<title></title>
	<style>
		.msgtt{margin-top:40px;padding-left:40px;font-size: 14px;color: rgba(0,0,0,0.75);}
		.msgtup1{margin:10px 0;padding-left:80px;font-size: 12px;color: #424242;}
		.startprotips_div{padding-left:80px;font-size: 12px;color: #FB565C;line-height: 21px;}
	</style>
</head>
<body class="xiangmuguanli jicharenwu updownbody">
	<!-- 项目成员 -->
	<ul class="choiseDanwei choiseDanwei12">
		<li>加载失败</li>
	</ul>
	<!-- 中心名称 -->
	<ul class="choiseDanwei choiseDanwei13">
		<li>加载失败</li>
	</ul>
	<!-- <h4 class="page_title">稽查任务<a class="creat_forse">新建任务</a></h4> -->
	<div class="btn_div">
		<table class="search_table">
			<tr>
				<td>
					<span class="sear_lable">项目/任务编号</span>
					<input id="xiangMuRenWuBianHao" class="com_input com_input1" type="text" />
				</td>
				<!-- <td>
					<span class="sear_lable">药品/器械名称</span>
					<input id="yaoPinQiXieName" class="com_input com_input2" type="text" />
				</td> -->
				<!-- <td>
					<span class="sear_lable">中心名称</span>
					<input id="zhongXinName" class="com_input com_input2" type="text" />
				</td> -->
				<td>
					<span class="sear_lable">项目成员</span>
					<input id="XiangMuChengYuan" class="com_input com_input2" type="text" />
				</td>
				<td>
					<span class="sear_lable">任务状态</span>
					<select id="reWuZhuangTai" class="com_select com_select2">
						<option value="">所有状态</option>
						<!-- <option value="任务计划">任务计划</option> -->
						<option value="模块填写中">模块填写中</option>
						<option value="初版报告修改">初版报告修改</option>
						<option value="项目经理修改">项目经理修改</option>
						<option value="提交评审">提交评审</option>
						<option value="评审中">评审中</option>
						<option value="评审后修改">评审后修改</option>
						<option value="商务部确认">商务部确认</option>
						<option value="商务部驳回">商务部驳回</option>
						<option value="任务完成">任务完成</option>
						<option value="任务取消">任务取消</option>
					</select>
				</td>
				<td>
					<span class="sear_lable">创建时间</span>
					<input class="com_input com_input3"  id="start_time" placeholder="起" type="text" />
				</td>
			</tr>
			<tr>
				<td >
					<span class="sear_lable">创建时间</span>
					<input class="com_input com_input4" id="end_time" placeholder="止" type="text" />
				</td>
				<td>
					
				</td>
				<td>
					
				</td>
				<td>
					
				</td>
			</tr>
		</table>
		<span class="searBtnTd">
			<a id="searchBtn" class="top_btn jiChaRenWu_sousuo">搜索</a>
			<a id="searchAll" class="top_btn type2">清空条件</a>
			<a class="upserBtn" href="javascript:;" >更多</a>
		</span>
		<div class="sear_line"></div>
	</div>
	<div class="m_info">
		<!-- 项目总数：<span id="totalElements" class="m_value">0</span> -->
		<a class="daochuCommonBtn jiChaRenWu_daochu" id="daochu" >导出</a>
		<a class="daochuCommonBtn jiChaRenWu_daochuwentiguina" style="left:74px;" id="daochuwentiguina" >导出问题归纳</a>
	</div>
	<div id="tableList" class="table_div">
	</div>
	<div class="pages">
        <div id="Pagination"></div>
        <div style="display:none;" class="searchPage">
          <span style="display:none;" class="page-sum">共<strong class="allPage">1</strong>页</span>
          <span class="page-sum">
			<select class="com_select pagesShow">
				<option value=10 >10条/页</option>
				<option value=30 >30条/页</option>
				<option value=50 >50条/页</option>
			</select>
		  </span>
          <span class="page-go">跳转<input type="text">页</span>
          <a href="javascript:;" class="page-btn gogo">GO</a>
        </div>
    </div>
	
	<!-- 弹窗 -->
	<div info="弹窗背景" class="stip_bg"></div>
	<div info="弹窗容器" class="stip_box">
		<div class="stip_content">
			<!--  -->
			<div style="width:410px;" class="sbox uploadfailtibox">
				<div class="msgtt"><i class="istips">!</i>开启任务失败</div>
				<div class="msgtup1">任务开启失败原因如下，请仔细检查以下步骤是否完成？</div>
				<div class="startprotips_div">
					<!-- <div class="msgtup">1、稽查计划没有上传</div>
					<div class="msgtup">2、临床试验方案没有上传</div>
					<div class="msgtup">3、项目基本信息没有填写完成</div> -->
				</div>
				<div class="sbox_btn_div">
					<a href="javascript:;" onclick="closeSbox()" class="sbox_btn btn2">确认</a>
				</div>
			</div>
			<!--  -->
		</div>
	</div>	
	
		
	
	
	
	<div style="display:none;" info="导出table" id="exportExcel"></div>
	<script type="text/javascript" src="../public/libs/jquery.min.js"></script>
	<script type="text/javascript" src="../public/laydate/laydate.js"></script>
	<script type="text/javascript" src="../public/libs/json.js"></script>
	<script type="text/javascript" src="../public/libs/base.js"></script>
	<script type="text/javascript" src="../public/libs/layer.js"></script>
	<script type="text/javascript" src="../public/libs/utils.js"></script>
	<script type="text/javascript" src="../public/js/common2.js"></script>
	<script type="text/javascript" src="../public/libs/jquery.pagination.js"></script>
	<script type="text/javascript" src="../public/libs/excelTable.js"></script>
	
</body>
<script>
$(function(){
	var g = {};
	g.login_token = Utils.offLineStore.get("token",false) || "";
	g.xrcode = Utils.getQueryString("xrcode") || "";//项目任务页面传来 传项目编号
	g.ser = Utils.getQueryString("ser") || "";//从工作台获取搜索项
	if(g.ser != ''){g.ser = decodeURI(g.ser)}//解码
	g.httpTip = new Utils.httpTip({});
	g.totalPage = 1;//存总页数
	g.nowPage = 0;//存当前页 0 是第一页
	g.showPages = 10;//每页显示多少行
	g.loadPage = true;//判断页面刚加载一次 定义分页的地方用
	g.ids = [];//存储当前所有项目id及其状态
	g.quanxuan = 0;
	
/* **************************************** lodding ******************************************** */	
	
	//判断权限
	is_show('.jiChaRenWu_daochu');
	is_show('.jiChaRenWu_daochuwentiguina');
	is_show('.jiChaRenWu_sousuo');
	
	//加载顶部标题
	$('#menu_show_t .ss',parent.document).removeClass('active').html('');
	//$('#menu_show_t .s0',parent.document).html('项目管理');
	$('#menu_show_t .s0',parent.document).html('稽查任务').addClass('active');
	
	$('#searchAll').on('click',function(){g.nowPage = 0;tableListShow(2)});
	$('#searchBtn').on('click',function(){g.nowPage = 0;tableListShow(1)});
	$('#daochuwentiguina').on('click',daochuguinawenti);
	loadPage();//加载页面
	
	
	
/* **************************************** setTing ******************************************** */	
	
	setSearchBuMen('.choiseDanwei12','稽查部','li','id');//给项目成员 选框赋值
	setGetSearchInput('#XiangMuChengYuan','.choiseDanwei12');//定义可以搜索下拉的
	//setSearchRole('.choiseDanwei13','中心名称','li');//给项目经理 选框赋值
	setGetSearchInput('#zhongXinName','.choiseDanwei13');//定义可以搜索下拉的
	
	//加载页面
	function loadPage(){
		
		getZhongXinMingCheng();//填充中心名称下拉
		//判断是不是从项目任务打开此页面
		if(g.xrcode != '' || g.ser != ''){
			if(g.ser != ''){$('#reWuZhuangTai').val(g.ser);}
			if(g.xrcode != ''){$('#xiangMuRenWuBianHao').val(g.xrcode).attr('readonly',true).addClass('readonly');}//给搜索项 项目编号赋值
			tableListShow(1);//显示列表
		}else{
			saveOrClearCookie(3,'r_');//加载搜索条件
			tableListShow(1);//显示列表
		}
		
	}
	
	//导出选中的归纳列表
	function daochuguinawenti(){
		var ids = getSetIDS();
		if(ids == ''){Utils.alert('请选择导出项！');return false;}
		var url = Base.serverUrl + "task/export?taskIds="+ids;
		window.open(url);
		//download(url,'问题归纳列表');
	}

	
	
	//填充中心名称下拉 从列表获取
	function getZhongXinMingCheng(){
		var condi = {};
		condi.number = 1000;//每页显示行数
		var url = Base.serverUrl + "task/progress/params";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var data = data.result || [];
					var data1 = data.centers || [];
					var data2 = data.Managers || [];
					var data3 = data.GroupLeaders || [];
					var html1 = '',html2 = '',html3 = '';
					for(var i=0,len=data1.length;i<len;i++){
						var name = data1[i] || [];
						html1 += '<li tip="'+name+'">'+name+'</li>';
					}
					$('.choiseDanwei13').html(html1);
				}
				else{
					var msg = data.message || "获取失败";
					//Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  Utils.alert("超时");
		　　　　}
			}
		});
	}
	//获取项目所有id列表
	function getids(){
		var condi = {};
		condi.number = 10000;//
		condi.code = g.xiangMuRenWuBianHao;//
		condi.medicine = g.yaoPinQiXieName;
		condi.center_name = g.zhongXinName;
		condi.member = g.XiangMuChengYuan;
		condi.status = g.reWuZhuangTai;
		condi.create_head = g.start_time;
		condi.create_tail = g.end_time;
		var url = Base.serverUrl + "task/search/ids";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var d = data.result || [];
					g.ids = [];
					for(var i=0,len=d.length;i<len;i++){
						var num = d[i] || '';
						if(num != ''){
							var zu = [num,0];
							g.ids.push(zu);
						}
					}
					//console.log(g.ids);
				}
				else{
					var msg = data.message || "获取失败";
					//Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  //Utils.alert("超时");
		　　　　}
			}
		});
	}
	//设置获取当前选中的导出项 全选 全取消
	function getSetIDS(id,sta){
		var id = id || '';//id : all 全选 : no 全部取消
		var sta = sta || '';
		var res = '';
		if(g.ids.length <= 0 ){return res;}
		for(var i=0,len=g.ids.length;i<len;i++){
			var d = g.ids[i] || '';
			var num = d[0] || '';
			var state = d[1] || 0;
			//获取当前选中项
			if(state == '1'){
				if(res == ''){
					res = num;
				}else{
					res = res + ',' + num;
				}
			}
			//设置当前选中项
			if(id != '' && sta != '' && id == num){
				g.ids[i][1] = sta;
			}
			//全选
			if(id == 'all' && sta == ''){
				g.ids[i][1] = '1';
			}
			//全部取消
			if(id == 'no' && sta == ''){
				g.ids[i][1] = '0';
			}
		}
		return res;
	}				
	//全选
	function selAll(){
		$('.xiangmuguanli').off('click','.check_box').on('click','.check_box',function(){
			var _this = $(this) || {};
			var _id = _this.attr('idx') || '';
			if(_this.hasClass('active')){
				_this.removeClass('active');
				if(_id != ''){getSetIDS(_id,'0');}//取消选中当前项
			}else{
				_this.addClass('active');
				if(_id != ''){getSetIDS(_id,'1');}//选中当前项
			}
		});
		
		$('.xiangmuguanli').off('click','.toAll').on('click','.toAll',function(){
			//$(this).toggleClass('active');
			if($(this).hasClass('active')){
				$('.tocommon').addClass('active');
				getSetIDS('all');//全选
				g.quanxuan = 1;
			}else{
				$('.tocommon').removeClass('active');
				getSetIDS('no');//全部取消
				g.quanxuan = 0;
			}
		});
		$('#daochu').off().on('click',toExcel);
	}
	
	//导出excel
	function toExcel(){
		if(!$('.tocommon').hasClass('active')){Utils.alert('请选择需要导出的项目！');return false;}
		exporttoexcel();//获取需要导出列表
	}
	
	//获取需要导出的EXCEL列表
	function exporttoexcel(){
		$('#daochu').off().on('click',function(){Utils.alert('请稍后！');});
		var ids = getSetIDS();
		var condi = {};
		condi.ids = ids;//当前页
		condi.number = 1000;//
		var url = Base.serverUrl + "task/search";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var data = data.result || [];
					var html = '';
					html += '<table class="table1">'
						+'<tr>'
							+'<th style="min-width:0px;">任务编号</th>'
							//+'<th style="min-width:0px;">项目药品/器械名称</th>'
							+'<th style="min-width:0px;">项目中心编号</th>'
							+'<th style="min-width:30px;">科室</th>'
							+'<th style="min-width:0px;">项目阶段</th>'
							+'<th style="min-width:0px;">稽查组长</th>'
							+'<th style="min-width:0px;">稽查员</th>'
							+'<th style="min-width:0px;">任务创建时间</th>'
							+'<th style="min-width:0px;">任务状态</th>'
						+'</tr>';
					var con = data || [];
					for(var i=0,len=con.length;i<len;i++){
						var d = con[i] || '';
						var id = d.id || '';
						var code = d.code || '';//
						var medicine = d.medicine || '';//
						var center_name = d.center_name || '';//
						var center_code = d.center_code || '';//
						var org_departments = d.org_departments || '';//
						var stage = d.stage || '';//
						var project_group_leader = d.project_group_leader || '';//
						var project_group_member = d.project_group_member || '';//
						var task_create_time = getDate(d.task_create_time || '');//
						var status = d.status || '';//
						html+='<tr>'
							+'<td>'+code+'</td>'
							//+'<td>'+medicine+'</td>'
							+'<td>'+center_code+'</td>'
							+'<td>'+org_departments+'</td>'
							+'<td>'+stage+'</td>'
							+'<td>'+project_group_leader+'</td>'
							+'<td>'+project_group_member+'</td>'
							+'<td>'+task_create_time+'</td>'
							+'<td>'+status+'</td>'
						+'</tr>';
					}	
					 html+='</table>';
					$('#exportExcel').html(html);
					$('#daochu').ExportExcel('exportExcel');  //前面为控制按钮的id 例如 #btn，后面为table的id 例如 table(不加#)。
					setTimeout(function(){$('#daochu').off().on('click',toExcel);},1000);
				}
				else{
					var msg = data.message || "导出失败";
					Utils.alert(msg);
					$('#daochu').off().on('click',toExcel);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				$('#daochu').off().on('click',toExcel);
				if(status=='timeout'){
		　　　　　  //Utils.alert("超时");
		　　　　}
			}
		});
	}

	//设置每页显示多少行
	$('.pagesShow').change(function(){
		var num = $(this).val() || 10;
		g.nowPage = 0;//回到第一页
		g.showPages = num;
		g.loadPage = true;//设置页面加载 配置分页
		tableListShow();//显示列表
	});
	
	$(".gogo").on("click",function(){
    	var allPage = g.totalPage;
    	//console.log(allPage);
      var goPage = $(".page-go input").val() - 1; //跳转页数
      if(goPage > -1 && goPage <= allPage){
		g.nowPage = goPage;
		tableListShow();//显示列表
      }else {
      	Utils.alert('超出范围!');
      }
      //清空用户跳转页数
      //$(".page-go input").val("");
    });
	
	//分页
	function setPages(){
		$("#Pagination").pagination(g.totalPage,{
			callback: PageCallback, 
			 prev_text: '<',             
			 next_text: '>',
			 current_page:g.nowPage
		});
		$('.allPage').html(g.totalPage);
		$('.searchPage').show();
	}
	function PageCallback(index, jq){
		  g.nowPage = index || 0;
		  tableListShow('pa');//列表
	 }
	 
	//列表
	function tableListShow(is){
		var is = is || '';
		g.xiangMuRenWuBianHao = $('#xiangMuRenWuBianHao').val() || '';
		g.yaoPinQiXieName = $('#yaoPinQiXieName').val() || '';
		g.zhongXinName = $('#zhongXinName').val() || '';
		//g.XiangMuChengYuan = $('#XiangMuChengYuan').val() || '';
		g.XiangMuChengYuan = $('#XiangMuChengYuan').attr('tipid') || '';
		g.reWuZhuangTai = $('#reWuZhuangTai').val() || '';
		g.start_time = $('#start_time').val() || '';
		g.end_time = $('#end_time').val() || '';
		var condi = {};
		condi.page = g.nowPage;//当前页
		condi.number = g.showPages;//每页显示行数
		if(is == 1 || is == 'pa'){//搜索条件
			condi.code = g.xiangMuRenWuBianHao;//
			condi.medicine = g.yaoPinQiXieName;
			condi.center_name = g.zhongXinName;
			condi.member = g.XiangMuChengYuan;
			condi.status = g.reWuZhuangTai;
			condi.create_head = g.start_time;
			condi.create_tail = g.end_time;
			getids();//查询当前筛选项下的所有ids
			g.loadPage = true;//开启分页
			saveOrClearCookie(2,'r_');//存储搜索条件
		}else if(is == 2){//搜索全部
			$('#xiangMuRenWuBianHao').val('');
			$('#yaoPinQiXieName').val('');
			$('#zhongXinName').val('');
			$('#XiangMuChengYuan').val('');
			$('#reWuZhuangTai').val('');
			$('#start_time').val('');
			$('#end_time').val('');//全部的时候 清空搜索项
			getids();//查询当前筛选项下的所有ids
			g.loadPage = true;//开启分页
			saveOrClearCookie(1,'r_');//清空搜索条件
		}
		var url = Base.serverUrl + "task/search";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var data = data.result || [];
					g.totalPage = data.totalPages || 0;//总页数
					var totalElements = data.totalElements || 0;//总共中心数
					//$('#totalElements').html(totalElements);
					var html = '';
					var sstr = '';
					if(g.quanxuan == 1){sstr = 'active';}
					html += '<table class="table1">'
						+'<tr>'
							+'<th class="padding_s"><div class="check_box toAll '+sstr+'"><i class="i"></i></div></th>'
							+'<th style="min-width:115px;">任务编号</th>'
							//+'<th style="min-width:100px;">药品/器械名称</th>'
							+'<th style="min-width:0px;">项目中心编号</th>'
							+'<th style="min-width:57px;">中心编号</th>'
							+'<th style="min-width:52px;">项目阶段</th>'
							+'<th style="min-width:52px;">稽查组长</th>'
							+'<th style="min-width:0px;">稽查员</th>'
							+'<th style="min-width:72px;">任务创建时间</th>'
							+'<th style="min-width:67px;">任务状态</th>'
							+'<th style="min-width:220px;">操作</th>'
						+'</tr>';
					var con = data.content || [];
					for(var i=0,len=con.length;i<len;i++){
						var d = con[i] || '';
						var id = d.id || '';
						var code = d.code || '';//
						var medicine = d.medicine || '';//
						var center_name = d.center_name || '';//
						var org_departments = d.org_departments || '';//
						var stage = d.stage || '';//
						var center_number = d.center_number || '';//
						var center_code = d.center_code || '';//
						var project_group_leader = d.project_group_leader || '';//
						var project_group_member = d.project_group_member || '';//
						var task_create_time = getDate(d.task_create_time || '');//
						var status = d.status || '';//
						var _task = d._task || '';//TRUE为已经生成报告
						var stra = '';
						//替换name为id
						project_group_leader = replaceName(project_group_leader);
						project_group_member = replaceName(project_group_member);
						//判断当前项是否选中
						for(var j=0,len1=g.ids.length;j<len1;j++){
							var ds = g.ids[j] || '';
							var num1 = ds[0] || '';
							var state11 = ds[1] || 0;
							if(id == num1 && state11 == '1'){stra = 'active'}
						}	
						html+='<tr>'
							+'<td class="padding_s"><div idx="'+id+'" class="check_box tocommon '+stra+'"><i class="i"></i></div></td>'
							+'<td>'+code+'</td>'
							//+'<td>'+medicine+'</td>'
							+'<td>'+center_code+'</td>'
							+'<td>'+center_number+'</td>'
							+'<td>'+stage+'</td>'
							+'<td>'+project_group_leader+'</td>'
							+'<td>'+project_group_member+'</td>'
							+'<td>'+task_create_time+'</td>'
							+'<td>'+status+'</td>'
							+'<td class="last">';
								if(status == '未开启'){
									html+='<a onclick="openrenwuFunc(\''+id+'\')" href="javascript:;" class="cao_btn cao_btn8">开启任务</a>';
								}
								if(status == '模块填写中'){
									html+='<a onclick="shengChengBaoGaoFunc(\''+id+'\')" href="javascript:;" class="cao_btn cao_btn3 jiChaRenWu_shengchengbaogao">生成报告</a>';
								}
								if(status != '未开启' && status != '' && status != '模块填写中' && status != '任务取消'){
									html+='<a onclick="chaoKanBaoGaoFunc(\''+id+'\',\''+code+'\',\''+status+'\')" href="javascript:;" class="cao_btn cao_btn2 jiChaRenWu_chakanbaogao">查看报告</a>';
								}
								if(status != '未开启')html+='<a onclick="moKuaiFunc(\''+id+'\',\''+code+'\',\''+status+'\')" href="javascript:;" class="cao_btn cao_btn1 jiChaRenWu_mokuai">模块</a>';
								if(status == '初版报告修改' || status == '项目经理修改' || status == '评审后修改' || status == '商务部驳回'){
									html+='<a onclick="tiJiaoFunc(\''+id+'\')" href="javascript:;" class="cao_btn cao_btn7 jiChaRenWu_tijiao">提交</a>';
								}
								if(status == '商务部确认'){	
									html+='<a onclick="boHuiFunc(\''+id+'\')" href="javascript:;" class="cao_btn cao_btn5 jiChaRenWu_bohui">驳回</a>';
								}
								if(status == '商务部确认'){
									html+='<a onclick="wanChengFunc(\''+id+'\')" href="javascript:;" class="cao_btn cao_btn6 jiChaRenWu_wancheng">完成</a>';
								}
							html+='</td>'
						+'</tr>';
					}	
					 html+='</table>';
					$('#tableList').html(html);
					selAll();//定义导出按钮
					if(g.ids.length <= 0){getids();}
					//加载分页
					if(g.loadPage){
						setPages();//分页
						if($('#Pagination').html() == ''){//判断是否显示分页跳转等
							$('.pagesShow,.page-go,.gogo').hide();
						}else{
							$('.pagesShow,.page-go,.gogo').show();
						}
						g.loadPage = false;
					}
					//判断权限
					is_show('.jiChaRenWu_chakanbaogao');
					is_show('.jiChaRenWu_shengchengbaogao');
					is_show('.jiChaRenWu_mokuai');
					is_show('.jiChaRenWu_tijiao');
					is_show('.jiChaRenWu_wancheng');
					is_show('.jiChaRenWu_bohui');
					
				}
				else{
					var msg = data.message || "获取项目信息失败";
					//Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  //Utils.alert("超时");
		　　　　}
			}
		});
	}
	
	//开启任务
	window.openrenwuFunc = function(id){
		var id = id || '';
		if(!confirm('确认开启任务吗？')){return false;}
		var condi = {};
		condi.id  = id;
		var url = Base.serverUrl + "task/open";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var data = data.result || [];
					Utils.alert('开启成功！');
					tableListShow();//列表
				}
				else{
					var msg = data.result || [];
					if($.isArray(msg)){
						if(msg.length <= 0){return false;}
						var msghtml = '';
						for(var i=0,len=msg.length;i<len;i++){
							var ii = i + 1;
							var da = msg[i] || '';
							msghtml+='<div class="msgtup">'+ii+'、'+da+'</div>';
						}
						$('.startprotips_div').html(msghtml);
						showSbox('.uploadfailtibox');
					}else{
						Utils.alert(msg);
					}
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  Utils.alert("超时");
		　　　　}
			}
		});
		
	}
	//生成报告
	window.shengChengBaoGaoFunc = function(id){
		var id = id || '';
		if(!confirm('确认生成报告吗？')){return false;}
		var condi = {};
		condi.task_id  = id;
		var url = Base.serverUrl + "task/report/generate";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var data = data.result || [];
					Utils.alert('生成成功！');
					tableListShow();//列表
				}
				else{
					var msg = data.message || [];
					Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  Utils.alert("超时");
		　　　　}
			}
		});
		
	}

	//提交
	window.tiJiaoFunc = function(id){
		var id = id || '';
		if(!confirm('确认提交吗？')){return false;}
		var condi = {};
		condi.task_id  = id;
		var url = Base.serverUrl + "task/report/commit";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var msg2 = data.message;
					Utils.alert(msg2);
					tableListShow();//列表
				}
				else{
					var msg = data.message || "失败";
					Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  Utils.alert("超时");
		　　　　}
			}
		});
		
	}
	//查看报告
	window.chaoKanBaoGaoFunc = function(id,code,status){
		var id = id || '';
		var code = code || '';
		var status = status || '';
		status = encodeURI(encodeURI(status));
		Utils.offLineStore.set("renidtobaogao",id,false);//传值 到稽查报告 传任务id
		Utils.offLineStore.set("renjicode",code,false);//传值 到稽查报告列表 到稽查发现 传任务code
		Utils.offLineStore.set("renstatustobaogao",status,false);//传值 到稽查报告列表 到稽查发现 传任务code
		//if(!$('#slideLmenu',parent.document).hasClass('shou')){
		//	parent.document.getElementById("slideLmenu").click();
		//	$('.header',parent.document).hide();
		//	$('.frame_div',parent.document).css('top','0px');
		//}//展开收起左边栏
		//parent.document.getElementById("iframeObj").src = '稽查报告.html?renidtobaogao='+id+'&renjicode='+code+'&renstatustobaogao='+status;
		var src = '稽查报告.html?renidtobaogao='+id+'&renjicode='+code+'&renstatustobaogao='+status;
		//window.open(src);
		parent.document.location.href = src;
	}
	//模块
	window.moKuaiFunc = function(id,code,status){
		var id = id || '';
		var code = code || '';
		var status = status || '';
		var task = status != '模块填写中' && status != '任务计划' ? '1' : '0';//根据状态判断是否已经生成报告
		Utils.offLineStore.set("renjiid",id,false);//传值 到稽查模块列表 传任务id
		Utils.offLineStore.set("renjicode",code,false);//传值 到稽查模块列表 到稽查发现 传任务code
		Utils.offLineStore.set("task",task,false);//传值 到稽查模块列表 传该任务是否已经生成报告
		parent.document.getElementById("iframeObj").src = '稽查模块.html?renjiid='+id+'&renjicode'+code+'&task'+task;
	}
	//驳回 商务驳回
	window.boHuiFunc = function(id){
		var id = id || '';
		if(!confirm('确认驳回吗？')){return false;}
		var condi = {};
		condi.task_id  = id;
		var url = Base.serverUrl + "task/report/commerce/reject";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var data = data.result || [];
					Utils.alert('驳回成功！');
					tableListShow();//列表
				}
				else{
					var msg = data.message || "失败";
					Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  Utils.alert("超时");
		　　　　}
			}
		});
		
	}
	//完成
	window.wanChengFunc = function(id){
		var id = id || '';
		if(!confirm('确认完成项目吗？')){return false;}
		var condi = {};
		condi.task_id  = id;
		var url = Base.serverUrl + "task/report/commerce/confirm";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var data = data.result || [];
					Utils.alert('项目完成成功！');
					tableListShow();//列表
				}
				else{
					var msg = data.message || "失败";
					Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  Utils.alert("超时");
		　　　　}
			}
		});
		
	}
	
	//加载时间控件
	var start = {
	  elem: '#start_time',
	  format: 'YYYY-MM-DD',
	  //min: laydate.now(), //设定最小日期为当前日期
	  max: '2099-06-16', //最大日期
	  istime: true,
	  istoday: false,
	  choose: function(datas){
		 //end.min = datas; //开始日选好后，重置结束日的最小日期
		 //end.start = datas //将结束日的初始值设定为开始日
	  }
	};
	var end = {
	  elem: '#end_time',
	  format: 'YYYY-MM-DD',
	  //min: laydate.now(),
	  max: '2099-06-16',
	  istime: true,
	  istoday: false,
	  choose: function(datas){
		start.max = datas; //结束日选好后，重置开始日的最大日期
	  }
	};
	laydate(start);
	laydate(end);

});

</script>
</html>
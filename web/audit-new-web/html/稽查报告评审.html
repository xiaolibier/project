<!doctype html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<meta content="IE=Edge,chrome=1" http-equiv="X-UA-Compatible">
	<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
	<meta content="yes" name="apple-mobile-web-app-capable">
	<meta content="black" name="apple-mobile-web-app-status-bar-style">
	<meta name="format-detection" content="telephone=no"/>
	<link rel="stylesheet" href="../public/css/common.css" />
	<link rel="stylesheet" href="../public/btncss/normalize.css" />
	<link rel="stylesheet" href="../public/btncss/vicons-font.css" />
	<!-- <link rel="stylesheet" href="../public/btncss/base.css" /> -->
	<link rel="stylesheet" href="../public/btncss/buttons.css" />
	<title></title>
	<style>
		/*.jichabaogao .body_content .jc_btn{display:none;}*/
		.stip_box .sbox.xiugaizhongxin2{width:530px;padding:11px 40px 5px;}
		.sbox.xiugaizhongxin2 .slable{width:25%;}
		.sbox.xiugaizhongxin2 .sbox_input{width:71%;}
		.sbox.xiugaizhongxin2 .sbox_select{width:72.5%;}
		.sbox.xiugaizhongxin2 textarea.sbox_input{width:72%;}
		.sbox.xiugaizhongxin2 .star{left:25%;}
		.sbox.xiugaizhongxin2 .sbox_input, .sbox.xiugaizhongxin2 .sbox_select{margin-bottom:3px;}
		.sbox.xiugaizhongxin2 .sbox_h4{margin:0;}
		.sbox.xiugaizhongxin2 .sbox_btn{margin:5px auto;}
		.sbox.xiugaizhongxin2 .sbox_c.type1{color:#FB565C;}
		.sbox.xiugaizhongxin2 .sbox_c.type1 textarea{color:#FB565C;}
		.sbox.xiugaizhongxin2 .sbox_c.type1 select{color:#FB565C;}
		.sbox.xiugaizhongxin2 .sbox_c.type2{color:#C49933;}
		.sbox.xiugaizhongxin2 .sbox_c.type2 textarea{color:#C49933;}
		.sbox.xiugaizhongxin2 .sbox_c.type2 select{color:#C49933;}
		.ininput{height:140px;}
	</style>
</head>
<body class="xiangmuguanli jichabaogao">
	<div class="jc_topBtn">
		<!-- 报告 -->
		<a href="javascript:;" style="display:none;" id="pingShenHouXiuGai" class="jc_btn type1">评审后修改</a>
		<a href="javascript:;" style="display:none;" id="reportGo" class="jc_btn type4">报告通过</a>
		<a href="javascript:;" id="backPage" class="jc_btn type5">返回</a>
	</div>
	<!----------------------------------- 报告内容 --------------------------------------------->
	<div class="body_content" style="margin:0 auto 100px;max-width:1200px;width:90%;">
	<div style="text-align:center;margin-bottom:11px;" class="biaoti1">
		<span style="font-family:STHeiti Light;font-size:34px;color:#666666;font-weight:600;">
		稽查报告</span>
	</div>
	<div style="text-align:center;margin-bottom:10px;" class="biaoti2">
		<span style="font-family:STHeiti Light;font-size:34px;color:#666666;font-weight:600;letter-spacing:0;">
		AUDIT REPORT</span>
	</div>
	<div style="text-align:center;margin-bottom:26px;" class="biaoti3">
		<span style="font-family:STFangsong;font-size:20px;font-weight:600;color:#666666;">
		项目编号：</span>
		<span class="projectCode" style="font-family:STFangsong;font-weight:600;font-size:20px;color:#666666;">
		3AUDIT2016055</span>
	</div>
	<div style="text-align:center;margin-bottom:36px;" class="diyibufen">
		<span style="font-family:STHeiti Light;font-size:21px;color:#666666;line-height:21px;">
			第一部分：稽查目的、范围、依据
		</span>
	</div>
	<!-- <div style="margin-bottom:10px;" class="diyibufen-ro1">
		<span style="font-family:STHeiti Light;font-size:20px;color:#495060;line-height:16px;">
			一：稽查目的
		</span>
	</div>
	<div style="margin-bottom:30px;" class="diyibufen-ro1-1">
		<span class="setvalue1" style="font-family:STFangsong;font-size:18px;color:#666666;line-height:20px;">
			
		</span>
	</div> -->
	<!-- <div style="margin-bottom:10px;" class="diyibufen-ro2">
		<span style="font-family:STHeiti Light;font-size:20px;color:#495060;line-height:16px;">
			二：稽查范围
		</span>
	</div>
	<div style="margin-bottom:30px;" class="diyibufen-ro1-1">
		<span class="setvalue2" style="font-family:STFangsong;font-size:18px;color:#666666;line-height:20px;">
			
		</span>
	</div> -->
	<div style="margin-bottom:10px;" class="diyibufen-ro2">
		<span style="font-family:STHeiti Light;font-size:20px;color:#495060;line-height:16px;">
			一、稽查依据
		</span>
	</div>
	<div style="margin-bottom:30px;" class="diyibufen-ro1-1">
		<span class="setvalue3" style="font-family:STFangsong;font-size:18px;color:#666666;line-height:20px;">
			<!-- 为了协助委托方完善项目质量管理系统，进一步提高项目质量，核实项目开展流程是否符合方案、SOP等相关要求；<br/>
			通过稽查药品链、样本链、受试者链、研究者链核实项目是否存在系统漏洞，完善项目SOP；<br/>
			对本项目目前实施风险进行评估，辅助项目组开展纠正及预防措施；<br/> -->
		</span>
	</div>
	<div style="text-align:center;margin-top:50px;margin-bottom:30px;" class="diyibufen">
		<span style="font-family:STHeiti Light;font-size:21px;color:#666666;line-height:16px;">
			第二部分：稽查内容
		</span>
	</div>
	<div style="margin-bottom:10px;" class="diyibufen-ro2">
		<span style="font-family:STHeiti Light;font-size:20px;color:#495060;line-height:16px;">
			一、稽查概要
		</span>
	</div>
	<div style="margin-bottom:0px;" class="diyibufen-ro1-1">
		<span class="auditAbstract" style="display:inline-block;font-family:STFangsong;font-size:18px;color:#666666;line-height:20px;">
			<!-- 我公司受申办单位海南通用三洋药业有限公司委托，于2017年2月21日至23日对本临床试验中心（以下简称“中心”）呼吸专业开展的II期项目，进行了为期3天的稽查工作。根据日程安排召开了访谈及末次会。<br/>
			本项临床试验计划入组28例，实际筛选32例，入组28例。临床试验中发生严重不良事件（SAE）0例。<br/>
			本次稽查药物临床试验病例28例，药物编号为81-108。稽查涵盖六个环节：<br/>
			（一）访谈研究者：于2 月23 日在门诊21楼呼吸科会议室与临床试验PI付秀华和药品管理员郭丽萍人进行持续1小时30分钟的访谈。过程中确认的信息包括：受试者筛选流程、发药流程、皮试流程及临床诊断相关问题。<br/>
			（二）查阅研究者文件夹：于2月21日15时在临床试验机构办公室查阅研究者文件夹。<br/>
			（三）复核试验用药品管理的执行情况：于2月21日16时在临床试验机构办公室核查试验用药品储存场所的温湿度记录、试验用药品接收、发放、回收及销毁记录等资料。<br/>
			（四）复核生物样本管理的执行情况：于2月23日10时在门诊5楼西区检验科查阅生物样本的采集、处理、保存、转运及检测等过程及资料。<br/>
			（五）查阅研究者操作记录：于2月22日9时在门诊3楼肾内科会议室查阅知情同意书、原始病历、以及CRF。<br/>
			（六）追溯实验室检查结果：针对医学检查（实验室检查和胸片）报告进行溯源。<br/>
			<br/>	
			稽查中共发现严重问题3个，主要问题11个，一般问题7个，见《稽查发现问题统计表》。其中，试验用药品的使用和实验室检查方面的问题较为突出，建议加强监督管理。<br/> -->
		</span>
	</div>
	<div style="margin-bottom:10px;" class="fx_title">
		<span style="margin-left:2%;display:inline-block;width:78%;font-family:STSongti-SC-Regular;font-size:12px;color:#666666;line-height:20px;">	
		</span>
		<div style="display:inline-block;width:19%;text-align:right;" class="fx_btnDiv">
			<a href="javascript:;" style="display:none;" class="jc_btn type1 pingGaiYaoBtn pingshenBTNS stract editit">评审</a>
			<!-- <a href="javascript:;" class="jc_btn type1 changeGaiyao saveit">保存</a> -->
			<!-- <a href="javascript:;" class="jc_btn type5 stract cancelit">取消</a> -->
			<!-- <div class="check_box"><i class="i"></i>已处理</div> -->
		</div>
	</div>
	<div style="text-align:right;display:none;" class="gaiyaoPing" info="评审框" >
		<div><span class="inlable type1">修改建议</span><textarea class="ininput xiugaivalue"></textarea></div>
		<!-- <div style="margin-top:5px;"><span class="inlable type2">评审意见</span><textarea class="ininput pingshenyijianValue"></textarea></div> -->
		<div style="text-align:right;margin-top:5px;">
			<a href="javascript:;" class="jc_btn type1 changeGaiyao saveit">保存</a>
			<a href="javascript:;" class="jc_btn type5 stract cancelit">取消</a>
		</div>
	</div>
	<div style="display:none;" class="gaiyaoXiuGaiJianYi gaiyaoXiuGaiJianYi1" info="修改建议">
		<span class="jc_tip type1">修改建议</span>
		<p class="jc_tip_text type1">
			
		</p>
	</div>
	<!-- <div info="评审意见">
		<span class="jc_tip type2">评审意见</span>
		<p class="jc_tip_text type2">
			这个问题要写明白点
		</p>
	</div>
	<div info="分级意见">
		<span class="jc_tip type3">分级意见</span>
		<p class="jc_tip_text type3">
			一般问题
		</p>
	</div> -->
	<!-- <div style="margin-bottom:10px;" class="diyibufen-ro2">
		<span style="font-family:STHeiti Light;font-size:20px;color:#495060;line-height:16px;">
			二、稽查发现问题统计
		</span>
	</div>
	<div class="tablesheetdiv"></div> -->
	<div style="text-align:center;margin-top:50px;margin-bottom:30px;" class="diyibufen">
		<span style="font-family:STHeiti Light;font-size:21px;color:#666666;line-height:16px;">
			第三部分：稽查发现
		</span>
	</div>
	<!-- <div style="margin-bottom:10px;" class="diyibufen-ro2">
		<span style="font-family:STSongti-SC-Bold;font-size:14px;color:#495060;line-height:16px;">
			一、严重问题
		</span>
	</div> -->
	<div class="questiondiv"></div>
		<!-- 专家点评 -->
		<div style="margin-left:2%;display:none;" class="zjdianpingyijian" info="点评意见">
			<span class="jc_tip type3">专家点评意见</span>
			<p class="jc_tip_text type1">
				
			</p>
		</div>
		<div style="margin-left:2%;"><a href="javascript:;" style="display:none;" class="jc_btn pingshenBTNS dianpingBtn type1">专家点评</a></div>
		<div class="zhuanjiaPingBox" style="text-align:right;display:none;" info="评审框" >
			<div><span class="inlable type3">专家点评</span><textarea class="ininput zhuanjiapingVlaue"></textarea></div>
			<div style="text-align:right;margin-top:5px;">
				<a href="javascript:;" class="jc_btn saveit type1">保存</a>
				<a href="javascript:;" class="jc_btn cancleit type5">取消</a>
			</div>
		</div>
	</div>
	<!-- 弹窗 -->
	<div info="弹窗背景" class="stip_bg"></div>
	<div info="弹窗容器" class="stip_box">
		<div class="stip_content">
			<!-- 添加依据 -->
			<div class="sbox tianjiayijubox" style="width:500px;">
				<h4 class="sbox_h4">添加依据</h4>
				<div id="yijutable" class="yijutable" style="height:356px;overflow:hidden;overflow-y:auto;">
					<!-- <table class="table1">
						<tr>
							<th><div class="check_box"><i class="i"></i></div></th>
							<th>分类</th>
							<th>问题归类</th>
							<th>依据</th>
						</tr>
						<tr>
							<td><div class="check_box"><i class="i"></i></div></td>
							<td>IMP2</td>
							<td>IMP201</td>
							<td>GCP 第五十七条　申办者负责对临床试验用药品作适当的包装与标签，并标明为临床试验专用。在双盲临床试验中，试验药物与对照药品或安慰剂在外形、气味、包装、标签和其他特征上均应一致。</td>
							
						</tr>
					</table> -->
				</div>
				<div class="sbox_btn_div" style="text-align:center;">
					<a href="javascript:;" id="noBtn" onclick="closeSbox()" class="sbox_btn btn1">取消</a>
					<a id="yesBtn" style="margin-left:25px;" href="javascript:;" class="sbox_btn btn2">确认</a>
				</div>
			</div>
			<!--  -->
			<div class="sbox xiugaizhongxin xiugaizhongxin2">
				<h4 class="sbox_h4">编辑发现</h4>
				<div class="sbox_c"><span class="slable">入报告</span>
					<i class="star"></i>
					<div id="ruBaoGao2" style="margin-top: 5px; margin-left: 2px;" class="check_box">
					<i class="i"></i>
					</div>
				</div>
				<div class="sbox_c"><span class="slable">受试者编号</span><i class="star"></i><input id="shouShiZheBianHao2" readonly class="sbox_input readonly" type="text"/></div>
				<div class="sbox_c"><span class="slable">问题说明</span><i class="star"></i><textarea id="wenTiShuoMing2" style="height:40px;" readonly class="sbox_input readonly"></textarea></div>
				<div class="sbox_c type1"><span class="slable">修改建议</span><i class="star"></i><textarea id="sboxxiugaijianyi" style="height:40px;" class="sbox_input"></textarea></div>
				<div class="sbox_c type2"><span class="slable">评审意见</span><i class="star"></i><textarea id="sboxpingshenyijian" style="height:40px;" class="sbox_input"></textarea></div>
				<div class="sbox_c"><span class="slable">分级</span><i class="star"></i>
					<select id="fenJi2" disabled="disabled" class="sbox_select readonly">
						<option value="">选择分级</option>
						<option value="严重问题">严重问题</option>
						<option value="主要问题">主要问题</option>
						<option value="一般问题">一般问题</option>
					</select>
				</div>
				<div class="sbox_c type1"><span class="slable">分级建议</span><i class="star"></i>
					<select id="fenJi22" class="sbox_select">
						<option value="">选择分级</option>
						<option value="严重问题">严重问题</option>
						<option value="主要问题">主要问题</option>
						<option value="一般问题">一般问题</option>
						<option value="不是问题">不是问题</option>
					</select>
				</div>
				<div class="sbox_c"><span class="slable">模块</span><i class="star"></i>
					<select id="moKuai2" disabled="disabled" class="sbox_select readonly">
						<option value="">选择模块</option>
					</select>
				</div>
				<div class="sbox_c"><span class="slable">分类</span><i class="star"></i>
					<select id="fenLei2" disabled="disabled" class="sbox_select readonly">
						<option value="">选择分类</option>
					</select>
				</div>
				<div class="sbox_c"><span class="slable">问题归纳</span><i class="star"></i>
					<input id="wenTiGuiNa2" readonly class="sbox_input readonly" type="text"/>
					<!-- <select id="wenTiGuiNa2" disabled="disabled" class="sbox_select readonly">
						<option value="">选择问题</option>
					</select> -->
				</div>
				<div class="sbox_c"><span class="slable">备注</span><i class="star"></i><textarea id="beiZhu2" style="height:40px;" readonly class="sbox_input readonly"></textarea></div>
				<div class="sbox_c"><span class="slable">创建人/创建时间</span><i class="star"></i><span id="ccinfo2" class="sbox_span"></span></div>
				<div class="sbox_c"><span class="slable">最近修改人/修改时间</span><i class="star"></i><span id="xxinfo2" class="sbox_span"></span></div>
				<div class="sbox_btn_div" style="text-align:center;">
					<a href="javascript:;" id="noBtn2" onclick="closeSbox()" class="sbox_btn btn1">取消</a>
					<a id="yesBtn2" style="margin-left:25px;" href="javascript:;" class="sbox_btn btn2">确认</a>
				</div>
			</div>
		</div>
	</div>	
	
	
	
	
	<script type="text/javascript" src="../public/libs/jquery.min.js"></script>
	<script type="text/javascript" src="../public/laydate/laydate.js"></script>
	<script type="text/javascript" src="../public/libs/json.js"></script>
	<script type="text/javascript" src="../public/libs/base.js"></script>
	<script type="text/javascript" src="../public/libs/layer.js"></script>
	<script type="text/javascript" src="../public/libs/utils.js"></script>
	<script type="text/javascript" src="../public/js/common2.js"></script>
	<!-- <script type="text/javascript" src="../public/js/index.js"></script> -->
	
</body>
<script>
$(function(){
	var g = {};
	g.login_token = Utils.offLineStore.get("token",false) || "";
	g.id = Utils.getQueryString("listtopingshenid") || Utils.offLineStore.get("listtopingshenid",false);//单中心报告评审页面传来 传任务id
	g.do = Utils.getQueryString("do") || Utils.offLineStore.get("do",false);//单中心报告评审页面传来 传评审还是查看 pingshen check
	g.httpTip = new Utils.httpTip({});
	g.totalPage = 1;//存总页数
	g.nowPage = 0;//存当前页 0 是第一页
	g.showPages = 10;//每页显示多少行
	g.loadPage = true;//判断页面刚加载一次 定义分页的地方用
	g.reportID = '';//存当前报告id
	g.reportNowVersion = '';//存当前报告版本
	
/* **************************************** lodding ******************************************** */	

	//加载顶部标题
	$('#menu_show_t .ss',parent.document).removeClass('active').html('');
	$('#menu_show_t .s0',parent.document).css('cursor','pointer').html('单中心报告评审').off().on('click',function(){
		//if($('#slideLmenu',parent.document).hasClass('shou')){
		//	parent.document.getElementById("slideLmenu").click();
		//	$('.header',parent.document).show();
		//	$('.frame_div',parent.document).css('top','50px');
			
		//}//展开收起左边栏
		parent.document.getElementById("iframeObj").src = '单中心报告评审.html';
	});
	$('#menu_show_t .s1',parent.document).html(' > 稽查报告评审').addClass('active');
	//$('#xiugaireport').on('click',function(){toEditStatic(1)});//变为修改状态
	//$('#checkreport').on('click',function(){toEditStatic(0)});//变为阅读状态
	//$('.body_content').on('click','.editit',changeSta1);//评审一条
	//$('.body_content').on('click','.cancelit',changeSta2);//取消一条
	$('.body_content').on('click','.changeWentiGuiNa',changeWentiGuiNaFunc);//修改单个问题归纳
	$('.body_content').on('click','.changeYiJu',changeOneYiJuFunc);//修改单个依据
	$('.body_content').on('click','.deleteOneYiJu',deleteOneYiJuFunc);//删除单个依据
	$('.body_content').on('click','.changeFaXianWenTi',changeFaXianWenTiFunc);//修改单个依据
	//$('.body_content').on('click','.addyijuit',yijuSboxShow);//显示添加依据弹窗
	$('.body_content').on('click','.xiangxiit',showDisSbox);//显示评审发现弹窗
	//$('.changeGaiyao').on('click',changeGaiYaoFunc);//修改稽查概要
	$('#yesBtn').on('click',addYiJuFunc);//修改稽查概要
	$('#pingShenHouXiuGai').on('click',pingshenhouFunc);//点击上面 评审后修改
	$('#reportGo').on('click',pingshengoFunc);//点击上面 评审通过
	$('#backPage').on('click',backpageto);//点击上面 返回
	
	//专家点评
	$('.dianpingBtn').on('click',dianpingBtnFunc);//评审
	$('.zhuanjiaPingBox .cancleit').on('click',canclePingzhuanjia);//取消
	$('.zhuanjiaPingBox .saveit').on('click',savePingzhuanjai);//保存
	//问题归纳
	$('.body_content').on('click','.guinaPingBtn',guinaBtnFunc);//评审
	$('.body_content').on('click','.wentiGuiNaPingShenBox .cancelit',canclePingguina);//取消
	$('.body_content').on('click','.wentiGuiNaPingShenBox .saveit',savePingGuina);//保存
	//评审概要
	$('.pingGaiYaoBtn').on('click',pingGaiYaoBtnFunc);//评审
	$('.gaiyaoPing .cancelit').on('click',canclePingBaoGao);//取消
	$('.gaiyaoPing .changeGaiyao').on('click',savePingBaoGao);//保存
	//依据评审
	$('.body_content').on('click','.changeYIjuBtn',yijuBtnFunc);//评审
	$('.body_content').on('click','.yijuPingShenBox .cancelit',canclePingYiJu);//取消
	$('.body_content').on('click','.yijuPingShenBox .saveit',savePingYiju);//保存
	//发现评审
	$('.body_content').on('click','.FaXianpingshen',faxianBtnFunc);//评审
	$('.body_content').on('click','.faxianPingShenBox .cancelit',canclePingFaXian);//取消
	$('.body_content').on('click','.faxianPingShenBox .saveit',function(){
		var obj = $(this) || {};
		savePingFaXian(obj);
	});//保存
	
	loadPage();//加载页面
	
	
/* **************************************** setTing ******************************************** */	
	
	
	
	//加载页面
	function loadPage(){
		if(g.id == ''){Utils.alert("任务id为空");return false;}
		$('#slideLmenu',parent.document).click();
		getReport();//加载报告
		getModelName();//加载稽查发现里面的 模块
		if(g.do == 'pingshen'){//评审
			$('#pingShenHouXiuGai,#reportGo,.pingshenBTNS').show();
		}
		//隐藏边栏
		//if(!$('#slideLmenu',parent.document).hasClass('shou')){
		//	parent.document.getElementById("slideLmenu").click();
		//	$('.header',parent.document).hide();
		//	$('.frame_div',parent.document).css('top','0px');
			
		//}//展开收起左边栏
	}
	
	//点击 返回页面
	function backpageto(){
		//if($('#slideLmenu',parent.document).hasClass('shou')){
		//	parent.document.getElementById("slideLmenu").click();
		//	$('.header',parent.document).show();
		//	$('.frame_div',parent.document).css('top','50px');
			
		//}//展开收起左边栏
		location.href = 'home.html?page=pingshen';
		//parent.document.getElementById("iframeObj").src = '单中心报告评审.html';
	}
	//改变报告为评审还是查看状态
	function toEditStatic(is){
		var is = is || '';
		if(is == 1){//变为修改状态
			$('.editit,.xiangxiit,.deleteit,.addyijuit').show();
			$('#checkreport').show();
			$('#xiugaireport').hide();
		}else if(is == 0){//变为阅读状态
			$('.body_content .jc_btn').fadeOut(200);
			$('#checkreport').hide();
			$('#xiugaireport').show();
			$('.edit_state').removeAttr('contenteditable').removeClass('edit_state');
		}
	}
	//-------------------------------------
	//评审概要
	function pingGaiYaoBtnFunc(){
		$('.pingGaiYaoBtn').hide();
		$('.gaiyaoPing').show();//评审框
		$('.gaiyaoXiuGaiJianYi1').hide();
	}
	//取消评审概要
	function canclePingBaoGao(){
		$('.gaiyaoPing').hide();//评审框
		$('.pingGaiYaoBtn').show();
		getReport();
	}
	//-----------------------------------------
	//点击专家点评
	function dianpingBtnFunc(){
		$('.zhuanjiaPingBox').show();//评审框
		$('.dianpingBtn').hide();
		$('.zjdianpingyijian').hide();
	}
	//点击取消专家点评
	function canclePingzhuanjia(){
		$('.zhuanjiaPingBox').hide();//评审框
		$('.dianpingBtn').show();
		getReport();
	}
	//------------------------------------------
	//点击问题归纳评审
	function guinaBtnFunc(){
		var ids = $(this).parents('.fx_btnDiv').attr('ids') || '';
		ids = ids.split(',');
		ids = ids.join('');
		$('.guinaPingBtn').hide();
		$('.wentiGuiNaPingShenBox'+ids).show();//评审框
		$(this).parents('.fx_title').siblings('.guinawentiyijian'+ids).hide();
	}
	//取消问题归纳评审
	function canclePingguina(){
		var ids = $(this).parents('.wentiGuiNaPingShenBox').attr('ids') || '';
		ids = ids.split(',');
		ids = ids.join('');
		$('.guinaPingBtn').show();
		$('.wentiGuiNaPingShenBox'+ids).hide();//评审框
		getReport();
	}
	//------------------------------------------
	//点击依据评审
	function yijuBtnFunc(){
		var ids = $(this).parents('.fx_btnDiv').attr('ids') || '';
		ids = ids.split(',');
		ids = ids.join('');
		$('.changeYIjuBtn').hide();
		$('.yijuPingShenBoxBtn'+ids).show();//评审框yijuPingShenBoxBtn
		$(this).parents('.fx_title').siblings('.yijupingshen'+ids).hide();
	}
	//取消依据评审
	function canclePingYiJu(){
		var ids = $(this).parents('.yijuPingShenBox').attr('ids') || '';
		ids = ids.split(',');
		ids = ids.join('');
		$('.changeYIjuBtn').show();
		$('.yijuPingShenBoxBtn'+ids).hide();//评审框
		getReport();
	}
	//-----------------------------------------------
	//点击发现评审
	function faxianBtnFunc(){
		var disid = $(this).parents('.fx_btnDiv').attr('disid') || '';
		$('.FaXianpingshen,.faxianXiangXi').hide();
		$('.faxianPingShenBox'+disid).show();//评审框
		$(this).parents('.fx_title').next('.faxianPingShenBox').siblings('.yijufaxianJianYi'+disid).hide();
	}
	//取消发现评审
	function canclePingFaXian(){
		var disid = $(this).parents('.faxianPingShenBox').attr('disid') || '';
		disid = disid.replace(",","");
		$('.FaXianpingshen,.faxianXiangXi').show();
		$('.faxianPingShenBox'+disid).hide();//评审框
		getReport();
	}
	//-----------------------------------------------
	
	
	
	
	
	//保存发现评审 建议 意见
	function savePingFaXian(obj){
		var obj = obj || {};
		var disid = obj.parents('.faxianPingShenBox').attr('disid') || '';
		var xiugaivalue = $('.faxianPingShenBox'+disid).find('.xiugaiValue').val() || '';//修改建议
		var yijianValue = $('.faxianPingShenBox'+disid).find('.yijianValue').val() || '';//评审意见
		xiugaivalue = trim2(xiugaivalue);
		yijianValue = trim2(yijianValue);
		var ids = $('.yijuPingShenBox').attr('ids') || '';//修改建议
		//if(xiugaivalue == '' && yijianValue == ''){Utils.alert('评审意见不能为空！');return false;}
		var condi = {};
		condi.reportId = g.reportID;
		condi.discoveryId = disid;
		condi.suggestion = yijianValue;
		condi.proposal = xiugaivalue;
		var url = Base.serverUrl + "task/report/reviewDiscoveryDetail";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var tips = '保存成功！';
					Utils.alert(tips);
					$('.faxianPingShenBox'+disid).find('.xiugaiValue').val('');
					$('.faxianPingShenBox'+disid).find('.yijianValue').val('');
					getReport();
					//canclePingBaoGao();
					//setTimeout(function(){$('#backPage').click();},1000);
				}
				else{
					var msg = data.message || "评审失败！";
					Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  //Utils.alert("超时");
		　　　　}
			}
		});
	}	
	
	//保存依据评审
	function savePingYiju(){
		var obj = $(this) || {};
		var ids = $(this).parents('.yijuPingShenBox').attr('ids') || '';
		var ids2 = ids.split(',');
		ids2 = ids2.join('');
		var xiugaivalue = $('.yijuPingShenBoxBtn'+ids2).find('.xiugaiValue').val() || '';//修改建议
		xiugaivalue = trim2(xiugaivalue);
		//var ids = $('.yijuPingShenBoxBtn'+ids).attr('ids') || '';//修改建议
		//if(xiugaivalue == ''){Utils.alert('评审意见不能为空！');return false;}
		var condi = {};
		condi.reportId = g.reportID;
		condi.ids = ids;
		condi.reviewContent = xiugaivalue;
		var url = Base.serverUrl + "task/report/reviewReference";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var tips = '保存成功！';
					Utils.alert(tips);
					$('.yijuPingShenBox').find('.xiugaiValue').val('');
					getReport();
					//canclePingBaoGao();
					//setTimeout(function(){$('#backPage').click();},1000);
				}
				else{
					var msg = data.message || "评审失败！";
					Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  //Utils.alert("超时");
		　　　　}
			}
		});
	}	
	//保存归纳评审
	function savePingGuina(){
		var ids = $(this).parents('.wentiGuiNaPingShenBox').attr('ids') || '';
		var ids2 = ids.split(',');
		ids2 = ids2.join('');
		var xiugaivalue = $('.wentiGuiNaPingShenBox'+ids2).find('.xiugaiValue').val() || '';//修改建议
		xiugaivalue = trim2(xiugaivalue);
		//if(xiugaivalue == ''){Utils.alert('评审意见不能为空！');return false;}
		var condi = {};
		condi.reportId = g.reportID;
		condi.ids = ids;
		condi.reviewContent = xiugaivalue;
		var url = Base.serverUrl + "task/report/reviewProblem";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var tips = '保存成功！';
					Utils.alert(tips);
					//$('.wentiGuiNaPingShenBox'+ids).find('.xiugaiValue').val('');
					getReport();
					
					//canclePingBaoGao();
					//setTimeout(function(){$('#backPage').click();},1000);
				}
				else{
					var msg = data.message || "评审失败！";
					Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  //Utils.alert("超时");
		　　　　}
			}
		});
	}	
	//保存专家点评
	function savePingzhuanjai(){
		var xiugaivalue = $('.zhuanjiaPingBox').find('.zhuanjiapingVlaue').val() || '';//修改建议
		xiugaivalue = trim2(xiugaivalue);
		//if(xiugaivalue == ''){Utils.alert('评审意见不能为空！');return false;}
		var condi = {};
		condi.reportId = g.reportID;
		condi.content = xiugaivalue;
		var url = Base.serverUrl + "task/report/comment";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var tips = '保存成功！';
					Utils.alert(tips);
					//$('.zhuanjiaPingBox').find('.zhuanjiapingVlaue').val('');
					getReport();
					canclePingzhuanjia();
					//canclePingBaoGao();
					//setTimeout(function(){$('#backPage').click();},1000);
				}
				else{
					var msg = data.message || "评审失败！";
					Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  //Utils.alert("超时");
		　　　　}
			}
		});
	}	
	//保存概要评审
	function savePingBaoGao(){
		var xiugaivalue = $('.gaiyaoPing').find('.xiugaivalue').val() || '';//修改建议
		xiugaivalue = trim2(xiugaivalue);
		//if(xiugaivalue == ''){Utils.alert('评审意见不能为空！');return false;}
		var condi = {};
		condi.reportId = g.reportID;
		condi.reviewContent = xiugaivalue;
		var url = Base.serverUrl + "task/report/reviewAbstract";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var tips = '保存成功！';
					Utils.alert(tips);
					$('.gaiyaoPing').find('.xiugaivalue').val('');
					getReport();
					canclePingBaoGao();
					//canclePingBaoGao();
					//setTimeout(function(){$('#backPage').click();},1000);
				}
				else{
					var msg = data.message || "评审失败！";
					Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  //Utils.alert("超时");
		　　　　}
			}
		});
	}		
	//加载报告
	function getReport(){
		var condi = {};
		condi.taskId = g.id;//
		condi.version = '';//
		
		var url = Base.serverUrl + "task/report/view";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var data = data.result || [];
					var id = data.id || '';//报告id
					var version = data.version || '';//报告version
					g.reportID = id;//存当前报告id
					g.reportNowVersion = version;//存当前报告version
					var projectCode = data.projectCode || '';//项目编号
					$('.projectCode').html(projectCode);
				//目的范围依据-----------------------------------------------
					var re = data.reportDetail || '';//
					var auditAim = re.auditAim || '';//目的
					var auditReference = re.auditReference || '';//依据
					var auditScope = re.auditScope || '';//范围
					var regstr=/\n/g;//替换换行符
					auditAim = auditAim.replace(regstr,'<br/>');
					auditReference = auditReference.replace(regstr,'<br/>');
					auditScope = auditScope.replace(regstr,'<br/>');
					$('.setvalue1').html(auditAim);
					$('.setvalue2').html(auditScope);
					$('.setvalue3').html(auditReference);
					
				//稽查概要--------------------------------------------------
					var auditAbstract = re.auditAbstract || '';//概要内容
					auditAbstract = auditAbstract.replace(regstr,'<br/>');
					var auditAbstractProposals = re.auditAbstractProposals || [];//修改建议
					$('.auditAbstract').html(auditAbstract);
					var auditAbstractProposalsSTR = '',auditAbstractProposalsSTR_last = '',auditAbstractProposalsSTR_ever = '';
					for(var i=0,len=auditAbstractProposals.length;i<len;i++){
						var aAP = auditAbstractProposals[i] || {};
						var reportId = aAP.reportId || '';
						var reportVersion = aAP.reportVersion || '';//评审版本
						var value = aAP.value || '';
						if(g.reportID != reportId){
							var _cor = 'color:#92CA7E';
							if(g.reportNowVersion == reportVersion + 1){_cor = 'color:#dca829';}
							value = '<span style="'+_cor+'">'+value+'</span>';
							auditAbstractProposalsSTR_ever = auditAbstractProposalsSTR_ever == '' ? value : auditAbstractProposalsSTR_ever +'<br/>'+ value;
						}
						else{auditAbstractProposalsSTR_last = value;}
						auditAbstractProposalsSTR = auditAbstractProposalsSTR == '' ? value : auditAbstractProposalsSTR +'<br/>'+ value;
					}
					if(auditAbstractProposalsSTR_last != ''){
						$('.gaiyaoXiuGaiJianYi1').show().find('.jc_tip_text').html(auditAbstractProposalsSTR_last);
						$('.gaiyaoPing').find('.xiugaivalue').val(auditAbstractProposalsSTR_last);
					}
					$('.gaiyaoXiuGaiJianYi_new').remove();//清空概要
					if(auditAbstractProposalsSTR_ever != ''){
						var gauyaoHtml = '';
						gauyaoHtml+='<div class="gaiyaoXiuGaiJianYi gaiyaoXiuGaiJianYi_new green" info="修改建议">'
								+'<span class="jc_tip type1">修改建议</span>'
								+'<p class="jc_tip_text type1">'+auditAbstractProposalsSTR_ever+'</p>'
							+'</div>';
						$('.gaiyaoXiuGaiJianYi1').before(gauyaoHtml);
					}
					
				//专家点评--------------------------------------------------
					var comments = data.comments || '';//
					if(comments != ''){
						$('.zjdianpingyijian').show().find('.jc_tip_text').html(comments);
						$('.zhuanjiaPingBox').find('.zhuanjiapingVlaue').val(comments);
					}
					
				//稽查发现问题统计表--------------------------------------------------
					var discoverySheet = re.discoverySheet || [];
					var tablesheet = '';
					tablesheet += '<table class="table1">'
						+'<tr>'
							+'<th rowspan="2" style="min-width:0px;">类别</th>'
							+'<th rowspan="2" style="min-width:0px;">子类</th>'
							+'<th colspan="3" style="min-width:0px;">发现分级</th>'
						+'</tr>'
						+'<tr>'
							+'<th style="min-width:0px;">严重问题</th>'
							+'<th style="min-width:0px;">主要问题</th>'
							+'<th style="min-width:0px;">一般问题</th>'
						+'</tr>';
						for(var i=0,len=discoverySheet.length;i<len;i++){
							var d = discoverySheet[i] || {};
							var module = d.module || '';//模块名
							var discoveryStatistics = d.discoveryStatistics || [];//列表
							for(var j=0,lenj=discoveryStatistics.length;j<lenj;j++){
								var dj = discoveryStatistics[j] || {};
								var category = dj.category || '';
								var common = dj.common || '/';
								var major = dj.major || '/';
								var serious = dj.serious || '/';
								tablesheet+='<tr>';
											if(j == 0)tablesheet+='<td rowspan="'+lenj+'">'+module+'</td>';
											tablesheet+='<td>'+category+'</td>'
											+'<td>'+serious+'</td>'
											+'<td>'+major+'</td>'
											+'<td>'+common+'</td>'
											+'</tr>';
							}				
						}	
					 tablesheet+='</table>';
					$('.tablesheetdiv').html(tablesheet);	
				//第三部分：稽查发现 --------------------------------------------------
					var seriousProblems = re.seriousProblems || [];//严重问题
					var majorProblems = re.majorProblems || [];//主要问题
					var commonProblems = re.commonProblems || [];//一般问题
					var qlist = '';
					var qqsi = ['一、','二、','三、'];
					var qqs = ['严重问题','主要问题','一般问题'];
					var obj_p = [seriousProblems,majorProblems,commonProblems];
					//遍历三个问题的 所有发现
					for(var ii=0,leni=qqs.length;ii<leni;ii++){
						var aa = ii + 1;
						var problemObj = obj_p[ii];//问题对象
						//if(problemObj.length <= 0){continue;}
						var qtitle = qqsi[ii] + qqs[ii];
						
							qlist+='<div style="margin-bottom:10px;" class="diyibufen-ro2">'
									+'<span style="STHeiti Light;font-size:16px;font-weight:600;color:#495060;line-height:16px;">'
										+qtitle
									+'</span>'
								+'</div>';
							if(problemObj.length <= 0){
								qlist+='<div style="margin-bottom:30px;" info="发现">'
								+'<div style="margin-bottom:10px;font-family:STFangsong;font-size:16px;font-weight:600;color:#666666;line-height:20px;" class="fx_title">'
								+'<span class="caneditit"  style="display:inline-block;font-weight:600;width:77%;font-family:STFangsong;font-size:16px;color:#666666;min-height:20px;vertical-align:middle;line-height:20px;">'
								+'未发现'
								+'</span>'
								+'	</div>';
								continue;
							}	
								
						//遍历所有问题归纳------------------------------------------------------
						for(var ikk=0,lenkk=problemObj.length;ikk<lenkk;ikk++){
							var listq = ikk + 1;
							var ds = problemObj[ikk] || {};
							var problem = ds.problem || '';//问题标题
							var ids = ds.ids || '';//问题标识 用于修改 归纳标识
							var ids2 = ids.split(',');
								ids2 = ids2.join('');
							var classify = ds.classify || '';//分类
							
							
							//遍历依据列表----------------------------------------------------------------
							var yijulist = '';
							var referenceStr = ds.referenceStr || '';//依据列表
							var referencelist = referenceStr.indexOf('<yiju>') > -1 ? referenceStr.split('<yiju>') : [referenceStr];
							for(var yi=0,lenyi=referencelist.length;yi<lenyi;yi++){
								var yijuname = referencelist[yi] || '';
								if(yijuname == 'null'){yijuname = '';}
								var yijuss = '',yijuss2 = '';
								if(yi == 0){yijuss = '依据：';yijuss2 = 'margin-left:0;width:73%;';}
								yijulist+='	<div style="margin-bottom:10px;margin-left:20px;font-family:STFangsong;font-size:18px;color:#666666;line-height:20px;" class="fx_title">'
								+yijuss+'<span class="caneditit"  style="margin-left:2%;vertical-align:top;display:inline-block;width:77%;'+yijuss2+'font-family:STFangsong;font-size:18px;color:#666666;min-height:20px;line-height:25px;">'
								+yijuname
								+'</span>';
								if(yi == lenyi-1){
									yijulist+='<div ids="'+ids+'" yijustring="'+referenceStr+'" num="'+yi+'" style="display:inline-block;float:right;width:19%;text-align:right;" class="fx_btnDiv">'
											+'<a href="javascript:;" style="display:none;" class="jc_btn type1 pingshenBTNS changeYIjuBtn editit">评审</a>'
										+'</div>';
								}
								yijulist+='</div>';
							}
							
							var referenceProposal = ds.referenceProposal || '';//依据评审列表
							var referenceProposalstr = '',referenceProposalstr_last = '',referenceProposalstr_ever = '';
							for(var i=0,len=referenceProposal.length;i<len;i++){
								var aAP = referenceProposal[i] || {};
								var reportId = aAP.reportId || '';
								var reportVersion = aAP.reportVersion || '';//评审版本
								var value = aAP.value || '';
								if(g.reportID != reportId){
									var _cor = 'color:#92CA7E';
									if(g.reportNowVersion == reportVersion + 1){_cor = 'color:#dca829';}
									value = '<span style="'+_cor+'">'+value+'</span>';
									referenceProposalstr_ever = referenceProposalstr_ever == '' ? value : referenceProposalstr_ever +'<br/>'+ value;
								}
								else{referenceProposalstr_last = value;}
								referenceProposalstr = referenceProposalstr == '' ? value : referenceProposalstr +'<br/>'+ value;
							}
							yijulist += '<div class="yijuPingShenBox yijuPingShenBoxBtn'+ids2+'" ids="'+ids+'" style="text-align:right;display:none;" info="评审框" >'
								+'<div><span class="inlable type1">修改建议</span><textarea class="ininput xiugaiValue">'+referenceProposalstr_last+'</textarea></div>'
								//+'<div style="margin-top:5px;"><span class="inlable type2">评审意见</span><textarea class="ininput"></textarea></div>'
								+'<div style="text-align:right;margin-top:5px;margin-bottom:10px;"><a class="jc_btn saveit type1">保存</a><a class="jc_btn cancelit type5">取消</a></div>'
							+'</div>';
							if(referenceProposalstr_ever != ''){//判断依据的建议是否为空 显示
								yijulist += '<div class="yijuJianYi green" style="margin-left:2%;" info="修改建议">'
									+'<span class="jc_tip type1">修改建议</span>'
									+'<p class="jc_tip_text type1">'+referenceProposalstr_ever+'</p>'
								+'</div>';
							}
							if(referenceProposalstr_last != ''){//判断依据的建议是否为空 显示
								yijulist += '<div class="yijuJianYi yijupingshen'+ids2+'" style="margin-left:2%;" info="修改建议">'
									+'<span class="jc_tip type1">修改建议</span>'
									+'<p class="jc_tip_text type1">'+referenceProposalstr_last+'</p>'
								+'</div>';
							}
							
							//遍历发现列表---------------------------------------------------------------
							var faxianlist = '';
							var discoveryList = ds.discoveryList || [];//发现列表
							var scoreNUM = 0,scoreNUMStr = ['a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z','a','b','c','d'];
							var xu_juhe = 1;//发现的序号
							for(var fa=0,lenfa=discoveryList.length;fa<lenfa;fa++){
								var vfa = fa + 1;
								var vfafa = fa - 1;
								var fd = discoveryList[fa] || '';
								var fd2 = discoveryList[vfa] || '';
								var fd3 = discoveryList[vfafa] || '';
								var disID = fd.id || '';//发现id
								var gradefenji = fd.grade || '';//分级
								var is_handle_grade_proposal = fd.is_handle_grade_proposal || '';//
								var patient_code = fd.patient_code || '';//受试者编号
								var patient_code2 = fd2.patient_code || '';//后一个受试者编号
								var patient_code3 = fd3.patient_code || '';//前一个受试者编号
								var problem_detail = fd.problem_detail || '';//问题详情
								patient_code = patient_code == '' ? '' : '受试者'+patient_code+'：';
								patient_code2 = patient_code2 == '' ? '' : '受试者'+patient_code2+'：';
								patient_code3 = patient_code3 == '' ? '' : '受试者'+patient_code3+'：';
								var patistr = '';
								if(patient_code != ''){patistr = 'width:65%;';}
								
								//聚合
								var juhe_is = false;
								if(patient_code2 == patient_code && patient_code != '' && scoreNUM == 0){//第一个相同
									faxianlist+='<div style="margin-bottom:10px;font-family:STFangsong;font-size:18px;color:#666666;line-height:20px;" class="fx_title">';
									faxianlist+='&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+xu_juhe +'）' +patient_code+'</div>';
									juhe_is = true;
									xu_juhe++;
								}
								faxianlist+='<div style="margin-bottom:10px;font-family:STFangsong;font-size:18px;color:#666666;line-height:20px;" class="fx_title">';
								//faxianlist+='&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+xu_juhe +'）' +patient_code;
								
								if(patient_code2 == patient_code && patient_code != '' && scoreNUM >= 0){//判断前后两个受试者编号相等
									faxianlist+='&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+scoreNUMStr[scoreNUM] +'）';
									scoreNUM++;
									juhe_is = true;
								}
								if(patient_code2 != patient_code && patient_code != '' && patient_code3 == patient_code){//是最后一个跟前面相同的相等
									faxianlist+='&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+scoreNUMStr[scoreNUM] +'）';
									scoreNUM = 0;
									juhe_is = true;
								}
								if(!juhe_is){//是最后一个跟前面相同的相等
									faxianlist+='&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'+xu_juhe +'）' +patient_code;
									
								}
								if(!juhe_is){xu_juhe++;}//判断是否聚合 改变序号
								faxianlist+='<span class="caneditit" disid="'+disID+'" style="margin-left:0;display:inline-block;width:75%;'+patistr+'font-family:STFangsong;font-size:18px;color:#666666;min-height:20px;vertical-align:top;line-height:20px;">'
								+problem_detail
								+'		</span>'
								+'		<div disid="'+disID+'" style="display:inline-block;float:right;width:19%;text-align:right;" class="fx_btnDiv">'
								+'			<a href="javascript:;" style="display:none;" class="jc_btn type1 pingshenBTNS FaXianpingshen editit">评审</a>'
								+'			<a href="javascript:;" style="display:none;" class="jc_btn type2 pingshenBTNS faxianXiangXi xiangxiit">详细</a>'
								//+'			<div class="check_box"><i class="i"></i>已处理</div>'
								+'		</div>'
								+'	</div>';
								var proposal = fd.proposal || '';//发现修改建议列表
								var proposalstr = '',proposalstr_last = '',proposalstr_ever = '';
								for(var i=0,len=proposal.length;i<len;i++){
									var aAP = proposal[i] || {};
									var reportId = aAP.reportId || '';
									var reportVersion = aAP.reportVersion || '';//评审版本
									var value = aAP.value || '';
									if(g.reportID != reportId){
										var _cor = 'color:#92CA7E';
										if(g.reportNowVersion == reportVersion + 1){_cor = 'color:#dca829';}
										value = '<span style="'+_cor+'">'+value+'</span>';
										proposalstr_ever = proposalstr_ever == '' ? value : proposalstr_ever +'<br/>'+ value;
									}else{proposalstr_last = value;}
									proposalstr = proposalstr == '' ? value : proposalstr +'<br/>'+ value;
								}
								var suggestion = fd.suggestion || '';//发现评审意见列表
								var suggestionstr = '',suggestionstr_last = '',suggestionstr_ever = '';
								for(var i=0,len=suggestion.length;i<len;i++){
									var aAP = suggestion[i] || {};
									var reportId = aAP.reportId || '';
									var reportVersion = aAP.reportVersion || '';//评审版本
									var value = aAP.value || '';
									if(g.reportID != reportId){
										var _cor = 'color:#92CA7E';
										if(g.reportNowVersion == reportVersion + 1){_cor = 'color:#dca829';}
										value = '<span style="'+_cor+'">'+value+'</span>';
										suggestionstr_ever = suggestionstr_ever == '' ? value : suggestionstr_ever +'<br/>'+ value;
									}
									else{suggestionstr_last = value;}
									suggestionstr = suggestionstr == '' ? value : suggestionstr +'<br/>'+ value;
								}
								var grade_proposal = fd.grade_proposal || '';//发现分级意见列表
								var grade_proposalstr = '',grade_proposalstr_last = '',grade_proposalstr_ever = '';
								for(var i=0,len=grade_proposal.length;i<len;i++){
									var aAP = grade_proposal[i] || {};
									var reportId = aAP.reportId || '';
									var reportVersion = aAP.reportVersion || '';//评审版本
									var value = aAP.value || '';
									if(g.reportID != reportId){
										var _cor = 'color:#92CA7E';
										if(g.reportNowVersion == reportVersion + 1){_cor = 'color:#dca829';}
										value = '<span style="'+_cor+'">'+value+'</span>';
										grade_proposalstr_ever = grade_proposalstr_ever == '' ? value : grade_proposalstr_ever +'<br/>'+ value;
									}
									else{grade_proposalstr_last = value;}
									grade_proposalstr = grade_proposalstr == '' ? value : grade_proposalstr +'<br/>'+ value;
								}
								faxianlist += '<div class="faxianPingShenBox faxianPingShenBox'+disID+'" disid="'+disID+'" style="text-align:right;display:none;" info="评审框" >'
									+'<div><span class="inlable type1">修改建议</span><textarea class="ininput xiugaiValue">'+proposalstr_last+'</textarea></div>'
									+'<div style="margin-top:5px;"><span class="inlable type2">评审意见</span><textarea class="ininput yijianValue">'+suggestionstr_last+'</textarea></div>'
									+'<div style="text-align:right;margin-top:5px;margin-bottom:10px;"><a class="jc_btn saveit type1">保存</a><a class="jc_btn cancelit type5">取消</a></div>'
								+'</div>';
								if(proposalstr_ever != ''){//判断发现的建议是否为空 显示(老的)
									faxianlist += '<div class="yijuJianYi green" style="margin-left:2%;" info="修改建议">'
										+'<span class="jc_tip type1">修改建议</span>'
										+'<p class="jc_tip_text type1">'+proposalstr_ever+'</p>'
									+'</div>';
								}
								if(suggestionstr_ever != ''){//判断发现的评审意见是否为空 显示(老的)
									
									faxianlist += '<div class="yijuJianYi green" style="margin-left:2%;" info="评审意见">'
										+'<span class="jc_tip type2">评审意见</span>'
										+'<p class="jc_tip_text type2">'+suggestionstr_ever+'</p>'
									+'</div>';
								}
								if(grade_proposalstr_ever != ''){//判断依据的建议是否为空 显示(老的)
									var strreff = 'green';
									//if(suggestionstr_ever.indexOf(gradefenji) <= -1){strreff = 'green2';}//判断处理跟意见不一样
									faxianlist += '<div class="yijuJianYi '+strreff+'" style="margin-left:2%;" info="分级意见">'
										+'<span class="jc_tip type3">分级意见</span>'
										+'<p class="jc_tip_text type3">'+grade_proposalstr_ever+'</p>'
									+'</div>';
								}
								if(proposalstr_last != ''){//判断发现的建议是否为空 显示
									faxianlist += '<div class="yijuJianYi yijufaxianJianYi'+disID+'" style="margin-left:2%;" info="修改建议">'
										+'<span class="jc_tip type1">修改建议</span>'
										+'<p class="jc_tip_text type1">'+proposalstr_last+'</p>'
									+'</div>';
								}
								
								if(suggestionstr_last != ''){//判断发现的评审意见是否为空 显示
									faxianlist += '<div class="yijuJianYi yijufaxianJianYi'+disID+'" style="margin-left:2%;" info="评审意见">'
										+'<span class="jc_tip type2">评审意见</span>'
										+'<p class="jc_tip_text type2">'+suggestionstr_last+'</p>'
									+'</div>';
								}
								
								if(grade_proposalstr_last != ''){//判断依据的建议是否为空 显示
									var strref4 = '';
									//if(grade_proposalstr_last != gradefenji && is_handle_grade_proposal == 1){strref4 = 'green2';}//判断处理跟意见不一样
									faxianlist += '<div class="yijuJianYi yijufaxianJianYi'+disID+' '+strref4+'" style="margin-left:2%;" info="分级意见">'
										+'<span class="jc_tip type3">分级意见</span>'
										+'<p class="jc_tip_text type3">'+grade_proposalstr_last+'</p>'
									+'</div>';
								}
								
							}
							
							
							//---归纳列表-----------------------------------------------------------------------
								var problemProposal = ds.problemProposal || [];//归纳的修改建议
								var problemProposalstr = '',problemProposalstr_last = '',problemProposalstr_ever = '';
								for(var i=0,len=problemProposal.length;i<len;i++){
									var aAP = problemProposal[i] || {};
									var reportId = aAP.reportId || '';
									var reportVersion = aAP.reportVersion || '';//评审版本
									var value = aAP.value || '';
									if(g.reportID != reportId){
										var _cor = 'color:#92CA7E';
										if(g.reportNowVersion == reportVersion + 1){_cor = 'color:#dca829';}
										value = '<span style="'+_cor+'">'+value+'</span>';
										problemProposalstr_ever = problemProposalstr_ever == '' ? value : problemProposalstr_ever +'<br/>'+ value;
									}
									else{problemProposalstr_last = value;}
									problemProposalstr = problemProposalstr == '' ? value : problemProposalstr +'<br/>'+ value;
								}
								qlist+='<div style="margin-bottom:30px;" info="发现">'
								+'	<div style="margin-bottom:10px;font-family:STFangsong;font-size:18px;font-weight:600;color:#666666;line-height:25px;" class="fx_title">'
								+listq+'、'+'<span class="caneditit" ids="'+ids+'" style="display:inline-block;width:77%;font-weight:600;font-family:STFangsong;font-size:16px;color:#666666;min-height:20px;vertical-align:middle;line-height:20px;">'
								+problem
								+'		</span>'
								+'		<div ids="'+ids+'" style="display:inline-block;float:right;width:19%;text-align:right;" class="fx_btnDiv">'
								+'			<a href="javascript:;" style="display:none;" class="jc_btn type1 pingshenBTNS guinaPingBtn editit">评审</a>'
								+'		</div>'
								+'	</div>'
								+'<div class="wentiGuiNaPingShenBox wentiGuiNaPingShenBox'+ids2+'" ids="'+ids+'" style="text-align:right;display:none;" info="评审框" >'
									+'<div><span class="inlable type1">修改建议</span><textarea class="ininput xiugaiValue">'+problemProposalstr_last+'</textarea></div>'
									//+'<div style="margin-top:5px;"><span class="inlable type2">评审意见</span><textarea class="ininput"></textarea></div>'
									+'<div style="text-align:right;margin-top:5px;margin-bottom:10px;"><a class="jc_btn saveit type1">保存</a><a class="jc_btn cancelit type5">取消</a></div>'
								+'</div>';
								
								if(problemProposalstr_ever != ''){//判断归纳的建议是否为空 显示
								qlist += '<div class="wentiguinaJianYi green" style="margin-left:2%;" info="修改建议">'
									+'<span class="jc_tip type1">修改建议</span>'
									+'<p class="jc_tip_text type1">'+problemProposalstr_ever+'</p>'
								+'</div>';
								}
								if(problemProposalstr_last != ''){//判断归纳的建议是否为空 显示
								qlist += '<div class="wentiguinaJianYi guinawentiyijian'+ids2+'" style="margin-left:2%;" info="修改建议">'
									+'<span class="jc_tip type1">修改建议</span>'
									+'<p class="jc_tip_text type1">'+problemProposalstr_last+'</p>'
								+'</div>';
								}
								qlist += faxianlist
								+'	<div style="margin-bottom:0px;margin-left:20px;" class="fx_title">'
								+'		<span style="display:inline-block;font-family:STFangsong;font-size:18px;color:#666666;line-height:25px;">'
								+'			分类：'+classify+''
								+'		</span>'
								+'	</div>'
								+yijulist
								//+'<div style="margin-left:2%;"><a href="javascript:;" yijustr="'+referenceStr+'" guina="'+ids+'" class="jc_btn addyijuit type3">添加</a></div>'
								+'</div>';	
						}
					}
					$('.questiondiv').html(qlist);
					//if(g.do == 'pingshen'){setTimeout(function(){toEditStatic(1);},1000);}//变为评审状态
					if(g.do == 'pingshen'){toEditStatic(1);}//变为评审状态
				}
				else{
					var msg = data.message || "获取报告失败";
					//Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  Utils.alert("超时");
		　　　　}
			}
		});
	}
	
	
	
	//点击上面 报告通过
	function pingshengoFunc(){
	    var id = id || '';
		var condi = {};
		condi.task_id = g.id;
		var url = Base.serverUrl + "task/report/review/confirm";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var tips = '评审通过成功！';
					Utils.alert(tips);
					setTimeout(function(){$('#backPage').click();},1000);
				}
				else{
					var msg = data.message || "评审失败！";
					Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  //Utils.alert("超时");
		　　　　}
			}
		});
	}	
	//点击上面 评审后修改
	function pingshenhouFunc(){
	    var id = id || '';
		var condi = {};
		condi.task_id = g.id;
		var url = Base.serverUrl + "task/report/review/reject";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var tips = '评审后修改成功！';
					Utils.alert(tips);
					setTimeout(function(){$('#backPage').click();},1000);
				}
				else{
					var msg = data.message || "评审失败！";
					Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  //Utils.alert("超时");
		　　　　}
			}
		});
	}
	//显示修改窗口
	function showDisSbox(){
		reloadSbox();//初始化弹窗
		$('.xiugaizhongxin2 .sbox_h4').html('发现评审');
		showSbox('.xiugaizhongxin2');//显示弹窗
		var id = $(this).parents('.fx_btnDiv').attr('disid') || '';
		$('#yesBtn2').off().on('click',function(){
			centerFunc(id);
		});
		editLoad(id);
	}	
	//初始化弹窗
	function reloadSbox(){
		$('.choiseDanwei li').removeClass('active');//清空弹窗的选择项
		$('.xiugaizhongxin input,.xiugaizhongxin textarea').val('');//清空弹窗
		$('.xiugaizhongxin select').val('');//清空弹窗
		$('#ccinfo').html('');
		$('#xxinfo').html('');
		$('#noBtn').html('取消');
		$('#yesBtn').off().show();
		$('#ruBaoGao2').off();//入报告 屏蔽
		var html = '<option value="">选择分级</option>'
		+'<option value="严重问题">严重问题</option>'
		+'<option value="主要问题">主要问题</option>'
		+'<option value="一般问题">一般问题</option>'
		+'<option value="不是问题">不是问题</option>';
		$('#fenJi22').html(html);
		//$('.xiugaizhongxin input,.xiugaizhongxin textarea').removeAttr('readonly').removeClass('readonly');//清空
		//$('.xiugaizhongxin select').removeAttr('disabled').removeClass('readonly');//清空
	}
	
	//加载稽查发现详情
	function editLoad(id){
		var id = id || '';
		var condi = {};
		condi.discoveryId = id;
		var url = Base.serverUrl + "task/report/getDiscovery";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var d = data.result || {};
					if(d.in_report == '是'){
						$('#ruBaoGao2').addClass('active');
					}else{$('#ruBaoGao2').removeClass('active');}
					//$('#moKuai').val(d.module_name || '');
					$('#shouShiZheBianHao2').val(d.patient_code || '');
					var gradeval = d.grade || '';
					$('#fenJi2').val(gradeval);
					$("#fenJi22 option[value='"+gradeval+"']").remove();
					$("#fenJi22").val('');
					//$('#fenLei2').val(d.classify || '');
					$('#wenTiGuiNa2').val(d.problem || '');
					var module_name = d.module_name || '';
					var classify = d.classify || '';
					var problem = d.problem || '';
					if(module_name != '')getModelName(module_name,'#moKuai2');
					if(classify != '')getFenlei(module_name,classify,'#fenLei2');//加载 分类
					//if(problem != '')getWenti(module_name,classify,problem,'#wenTiGuiNa2');//加载 问题
					$('#wenTiShuoMing2').val(d.problem_detail || '');
					$('#beiZhu2').val(d.remark || '');	
					var creator = d.creator || '';
					var create_time = getDate(d.create_time || '');
					var ccr = creator == '' || create_time == '' ? '' : creator+'/'+ create_time; 
					var last_modifier = d.last_modifier || '';
					var last_modify_time = getDate(d.last_modify_time || '');
					var llr = last_modifier == '' || last_modify_time == '' ? '' : last_modifier+'/'+ last_modify_time; 
					$('#ccinfo2').html(ccr);
					$('#xxinfo2').html(llr);
					$('#yesBtn').attr('aid',d.id);
					//评审意见 修改建议 分级建议
					var grade_proposal = d.grade_proposal || [];//分级建议
					var suggestion = d.suggestion || [];//评审意见
					var proposal = d.proposal || [];//修改建议
					for(var i=0,len=grade_proposal.length;i<len;i++){
						var aAP = grade_proposal[i] || {};
						var reportId = aAP.reportId || '';
						var value = aAP.value || '';
						if(g.reportID == reportId){$('#fenJi22').val(value);}
					}
					for(var i=0,len=suggestion.length;i<len;i++){
						var aAP = suggestion[i] || {};
						var reportId = aAP.reportId || '';
						var value = aAP.value || '';
						if(g.reportID == reportId){$('#sboxpingshenyijian').val(value);}
					}
					for(var i=0,len=proposal.length;i<len;i++){
						var aAP = proposal[i] || {};
						var reportId = aAP.reportId || '';
						var value = aAP.value || '';
						if(g.reportID == reportId){$('#sboxxiugaijianyi').val(value);}
					}
				}
				else{
					var msg = data.message || "加载失败！";
					Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  //Utils.alert("超时");
		　　　　}
			}
		});
	}
	
	//发现 提交评审意见
	function centerFunc(id){
	    var id = id || '';
		var ruBaoGao = $('#ruBaoGao2').hasClass('active') || false;
		var suggestion = $('#sboxpingshenyijian').val() || '';//评审意见
		var proposal = $('#sboxxiugaijianyi').val() || '';//修改建议
		var proposal = $('#sboxxiugaijianyi').val() || '';//修改建议
		var gradeProposal = $('#fenJi22').val() || '';//分级建议

		var condi = {};
		condi.page = g.nowPage;//当前页
		condi.number = g.showPages;//每页显示行数
		condi.reportId = g.reportID;
		condi.discoveryId = id;
		condi.inReport = ruBaoGao ? '是' : '否' ;
		condi.suggestion = suggestion;
		condi.proposal = proposal;
		condi.gradeProposal = gradeProposal;
		var url = Base.serverUrl + "task/report/reviewDiscovery";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var tips = '评审成功！';
					Utils.alert(tips);
					closeSbox();//关闭弹窗
					getReport();
					//setTimeout(function(){$('#xiugaireport').click();},1000);
				}
				else{
					var msg = data.message || "修改失败！";
					Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  //Utils.alert("超时");
		　　　　}
			}
		});
	}
	//搜索条件 模块名称填充数据
	function getModelName(moren,x){
		var moren = moren || '';
		var x = x || '';
		var condi = {};
		//condi.page = g.nowPage;//当前页
		//condi.number = g.showPages;//每页显示行数
		condi.task_id = g.id;//根据任务id查询模块
		var url = Base.serverUrl + "task/modules";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var data = data.result || [];
					var con = data || [];
					var html = '<option value="">选择模块</option>';
					//var html2 = '<option value="">选择模块</option>';
					for(var i=0,len=con.length;i<len;i++){
						var d = con[i] || '';
						var id = d.id || '';
						var name = d.module_name || '';//名称
						var _select = (moren == name && name != '') ? 'selected = "selected"' : '';
						html+='<option '+_select+' mid="'+id+'" name="'+name+'" value="'+name+'">'+name+'</option>';
						//html2+='<option '+_select+' name="'+name+'" value="'+name+'">'+name+'</option>';
					}	
					if(x != ''){$(x).html(html);}
					$('#moKuai2').html(html);
					
				}
				else{
					var msg = data.message || "获取失败";
					//Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  //Utils.alert("超时");
		　　　　}
			}
		});
	}
	//根据模块获取分类
	$('#moKuai2').change(function(){
		var name1 = $(this).find('option:selected').attr('name') || '';
		getFenlei(name1,'','#fenLei2');
	});
	//动态定义 根据分类获取 问题
	$('#fenLei2').change(function(){
		var module_name1 = $(this).find('option:selected').attr('name1') || '';
		var category_name = $(this).find('option:selected').attr('name') || '';
		getWenti(module_name1,category_name,'','#wenTiGuiNa2');
	}); 
	//加载分类
	function getFenlei(name1,moren,x){
		var name1 = name1 || '';
		var moren = moren || '';
		var x = x || '';
		var condi = {};
		//condi.page = g.nowPage;//当前页
		//condi.number = g.showPages;//每页显示行数
		condi.module_name = name1;
		var url = Base.serverUrl + "category/search";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			async:false,
			success: function(data){
				var status = data.success || false;
				if(status){
					var data = data.result || [];
					var con = data.content || [];
					//var html = '<option value="">选择分类</option>';
					var html2 = '<option value="">选择分类</option>';
					for(var i=0,len=con.length;i<len;i++){
						var d = con[i] || {};
						var id = d.id || '';
						var name = d.name || '';//名称
						var _select = (moren == name && name != '') ? 'selected = "selected"' : '';
						//html+='<option '+_select+' name1="'+name1+'" name="'+name+'" value="'+name+'">'+name+'</option>';
						html2+='<option '+_select+' name1="'+name1+'" name="'+name+'" value="'+name+'">'+name+'</option>';
					}	
					if(x != ''){$(x).html(html2);}
					else{$('#fenLeiMingCheng').html(html2);}//新增窗口使用
					
				}
				else{
					var msg = data.message || "获取失败";
					//Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  //Utils.alert("超时");
		　　　　}
			}
		});
	}
	function getWenti(module_name,category_name,moren,x){
		var module_name = module_name || '';
		var category_name = category_name || '';
		var moren = moren || '';
		var x = x || '';
		var condi = {};
		//condi.page = g.nowPage;//当前页
		//condi.number = g.showPages;//每页显示行数
		condi.module_name = module_name;
		condi.category_name = category_name;
		var url = Base.serverUrl + "problem/search";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			async:false,
			success: function(data){
				var status = data.success || false;
				if(status){
					var data = data.result || [];
					var con = data.content || [];
					//var html = '<option value="">选择问题</option>';
					var html2 = '<option value="">选择问题</option>';
					for(var i=0,len=con.length;i<len;i++){
						var d = con[i] || {};
						var id = d.id || '';
						var name = d.name || '';//名称
						var _select = (moren == name && name != '') ? 'selected = "selected"' : '';
						//html+='<option '+_select+' value="'+name+'">'+name+'</option>';
						html2+='<option '+_select+' value="'+name+'">'+name+'</option>';
					}	
					if(x != ''){$(x).html(html2);}
					else{$('#wenTiGuiNa').html(html2);}//新增窗口使用
					
				}
				else{
					var msg = data.message || "获取失败";
					//Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  //Utils.alert("超时");
		　　　　}
			}
		});
	}
	//添加依据弹窗 全选
	$('.tianjiayijubox').off('click','.toAll').on('click','.toAll',function(){
		//$(this).toggleClass('active');
		if($(this).hasClass('active')){
			$('.tocommon').addClass('active');
		}else{
			$('.tocommon').removeClass('active');
		}
	});
	//删除单行依据
	function deleteOneYiJuFunc(){
		if(!confirm('确认删除该项依据吗？')){return false;}
		var _this = $(this) || '';
		if(_this == ''){Utils.alert('按钮对象不能为空！');return false;}
		var ids = _this.parents('.fx_btnDiv').attr('ids') || '';//获取当前归纳的ids
		var yiju = _this.parents('.fx_btnDiv').attr('yijustring') || '';//当前归纳的依据集合
		var num = _this.parents('.fx_btnDiv').attr('num') || '';//判断当前是第几个 依据
		if(ids == ''){Utils.alert('归纳标识不能为空！');return false;}
		if(yiju == ''){Utils.alert('获取当前依据集合失败！');return false;}
		if(num == ''){Utils.alert('获取当前依据是第几个失败！');return false;}
		var yijulist = yiju.split('<yiju>') || [];
		if(yijulist.length > 0){
			yijulist.splice(num,1);
		}
		yiju = yijulist.join('<yiju>');
		YiJucommonFunc(ids,yiju);
	}
	//修改单行依据
	function changeOneYiJuFunc(){
		var _this = $(this) || '';
		var newthis = _this.parents('.fx_title').find('.caneditit').html() || '';
		if(newthis == ''){Utils.alert('依据不能为空！');return false;}
		if(_this == ''){Utils.alert('按钮对象不能为空！');return false;}
		var ids = _this.parents('.fx_btnDiv').attr('ids') || '';//获取当前归纳的ids
		var yiju = _this.parents('.fx_btnDiv').attr('yijustring') || '';//当前归纳的依据集合
		var num = _this.parents('.fx_btnDiv').attr('num') || '';//判断当前是第几个 依据
		if(ids == ''){Utils.alert('归纳标识不能为空！');return false;}
		if(yiju == ''){Utils.alert('获取当前依据集合失败！');return false;}
		if(num == ''){Utils.alert('获取当前依据是第几个失败！');return false;}
		var yijulist = yiju.split('<yiju>') || [];
		if(yijulist.length > 0){
			yijulist[num] = newthis;
		}
		yiju = yijulist.join('<yiju>');
		YiJucommonFunc(ids,yiju);
	}
	
	
	//添加依据
	function addYiJuFunc(){
		var _this = $(this) || {};
		var ids = _this.attr('ids') || '';//获取当前归纳的ids
		var yiju = _this.attr('yijustr') || '';//当前归纳的依据集合
		var _str = '';
		$('#yijutable').find('.yijuCheck').each(function(){//遍历选择项的依据 存起来
			if($(this).hasClass('active')){
				var syiju = $(this).parents('td').siblings('.categoryClass').html() || '';
				_str = _str != '' ? _str+'<yiju>'+syiju : syiju ;
			}
		});
		yiju =  yiju != '' && yiju != 'null' ? yiju+'<yiju>'+_str : _str ;
		if(ids == ''){Utils.alert('归纳标识不能为空！');return false;}
		YiJucommonFunc(ids,yiju);
	}
	
	function YiJucommonFunc(ids,yiju){
		var ids = ids || '';
		var yiju = yiju || '';
		var condi = {};
		condi.reportId = g.reportID;
		condi.ids = ids;
		condi.reference = yiju;
		var url = Base.serverUrl + "task/report/saveReference";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var data = data.result || {};
					Utils.alert('依据修改成功！');
					if($('.tianjiayijubox').css('display') != 'none')closeSbox('.tianjiayijubox');//关闭弹窗
					getReport();
					//toEditStatic(1);
					setTimeout(function(){$('#xiugaireport').click();},1000);
				}
				else{
					var msg = data.message || "添加失败";
					//Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  Utils.alert("超时");
		　　　　}
			}
		});
	}

	//添加依据弹窗获取 依据数据
	function yijuSboxShow(){
		var _this = $(this) || {};
		var ids = _this.attr('guina') || '';//获取当前归纳的ids
		var yiju = _this.attr('yijustr') || '';//获取当前归纳的依据集合
		if(ids == ''){Utils.alert('归纳标识不能为空！');return false;}
		var condi = {};
		condi.ids = ids;
		var url = Base.serverUrl + "task/report/reference/search";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var data = data.result || {};
					var html = '';
					html += '<table class="table1">'
						+'<tr>'
							+'<th><div class="check_box toAll"><i class="i"></i></div></th>'
							+'<th style="min-width:30px;">分类</th>'
							+'<th style="min-width:52px;">问题归类</th>'
							+'<th style="min-width:52px;">依据</th>'
						+'</tr>';
					var con = data || [];
					for(var i=0,len=con.length;i<len;i++){
						var d = con[i] || '';
						var id = d.id || '';
						var module_code = d.module_code || '';
						var problem_code = d.problem_code || '';
						var category_name = d.category_name || '';
						html+='<tr>'
							+'<td><div idx="'+id+'" class="check_box tocommon yijuCheck"><i class="i"></i></div></td>'
							+'<td>'+module_code+'</td>'
							+'<td>'+problem_code+'</td>'
							+'<td class="categoryClass">'+category_name+'</td>'
						+'</tr>';
					}	
					 html+='</table>';
					$('#yijutable').html(html);
					$('#yesBtn').attr('ids',ids);
					$('#yesBtn').attr('yijustr',yiju);
					showSbox('.tianjiayijubox');//显示弹窗
				}
				else{
					var msg = data.message || "加载失败";
					//Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  Utils.alert("超时");
		　　　　}
			}
		});
	}
	//修改单行发现问题
	function changeFaXianWenTiFunc(){
		var _this = $(this) || {};
		var objit = _this.parents('.fx_title').find('.caneditit') || {};
		var disID = objit.attr('disid') || '';
		var _val = objit.html() || '';
		var auditAbstract = $('.auditAbstract').html() || '';
		if(auditAbstract == ''){Utils.alert('发现不能为空！');return false;}
		var condi = {};
		condi.reportId = g.reportID;
		condi.discoveryId = disID;
		condi.discoveryDetail = _val;
		var url = Base.serverUrl + "task/report/saveDiscovery";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					Utils.alert('修改成功！');
					objit.removeAttr('contenteditable').removeClass('edit_state');
					//changeSta2(_this);//变为编辑状态
					getReport();
					setTimeout(function(){$('#xiugaireport').click();},1000);
				}
				else{
					var msg = data.message || "修改失败";
					//Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  Utils.alert("超时");
		　　　　}
			}
		});
	}

	//修改单行问题归纳
	function changeWentiGuiNaFunc(){
		var _this = $(this) || {};
		var objit = _this.parents('.fx_title').find('.caneditit') || {};
		var ids = objit.attr('ids') || '';
		var _val = objit.html() || '';
		var auditAbstract = $('.auditAbstract').html() || '';
		if(auditAbstract == ''){Utils.alert('问题归纳不能为空！');return false;}
		var condi = {};
		condi.reportId = g.reportID;
		condi.ids = ids;
		condi.problem = _val;
		var url = Base.serverUrl + "task/report/saveProblem";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					Utils.alert('修改成功！');
					objit.removeAttr('contenteditable').removeClass('edit_state');
					//changeSta2(_this);//变为编辑状态
					getReport();
					setTimeout(function(){$('#xiugaireport').click();},1000);
				}
				else{
					var msg = data.message || "修改失败";
					//Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  Utils.alert("超时");
		　　　　}
			}
		});
	}
	//修改稽查概要
	function changeGaiYaoFunc(){
		var auditAbstract = $('.auditAbstract').html() || '';
		if(auditAbstract == ''){Utils.alert('稽查概要不能为空！');return false;}
		var condi = {};
		condi.reportId = g.reportID;
		condi.reportAbstract = auditAbstract;
		var url = Base.serverUrl + "task/report/saveAbstract";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					Utils.alert('修改成功！');
					$('.auditAbstract').removeAttr('contenteditable').removeClass('edit_state');
					//changeSta2(_this);//变为编辑状态
					getReport();
					setTimeout(function(){$('#xiugaireport').click();},1000);
				}
				else{
					var msg = data.message || "修改失败";
					//Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  Utils.alert("超时");
		　　　　}
			}
		});
	}
	//变为修改状态 带保存 取消按钮
	function changeSta1(obj){
		var _this = $(this) || '';
		var obj = obj || '';
		//var _this = obj == '' ? _this : obj;
		if(_this == ''){Utils.alert("按钮对象为空！");return false;}
		
		if(_this.hasClass('stract')){//判断是编辑稽查概要 
			$('.auditAbstract').attr('contenteditable',true).addClass('edit_state');
		}else{
			_this.parents('.fx_title').find('.caneditit').attr('contenteditable',true).addClass('edit_state');
		}
		
		_this.hide().siblings('.deleteit,.xiangxiit').hide();
		_this.siblings('.saveit,.cancelit').show();
		
	}
	//变状态 带修改 删除 详情按钮
	function changeSta2(obj){
		var _this = $(this) || '';
		var obj = obj || '';
		//var _this = obj == '' ? $(this) : obj;
		if(_this == ''){Utils.alert("按钮对象为空！");return false;}
		if(_this.hasClass('stract')){//判断是编辑稽查概要 
			$('.auditAbstract').removeAttr('contenteditable').removeClass('edit_state');
		}else{
			_this.parents('.fx_title').find('.caneditit').removeAttr('contenteditable').removeClass('edit_state');
		}
		_this.hide().siblings('.deleteit,.xiangxiit,.editit').show();
		_this.siblings('.saveit').hide();
		
	}
	

	
	

});

</script>
</html>
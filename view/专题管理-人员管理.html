<!doctype html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<meta content="IE=Edge,chrome=1" http-equiv="X-UA-Compatible">
	<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
	<meta content="yes" name="apple-mobile-web-app-capable">
	<meta content="black" name="apple-mobile-web-app-status-bar-style">
	<meta name="format-detection" content="telephone=no"/>
	<link rel="stylesheet" href="../public/libs/kindeditor/themes/default/default.css" />
	<link rel="stylesheet" href="../public/libs/kindeditor/plugins/code/prettify.css" />
	<link rel="stylesheet" href="../public/css/common.css" />
	<title></title>
	<style>
		.check_box .i, .check_box2 .i{margin-right:5px;}
		.updownbody .search_table tr:nth-child(2), .updownbody .search_table tr:nth-child(3), .updownbody .search_table tr:nth-child(4){display:table-row;}
		.daochuCommonBtn{background:none;}
		.updownbody .searBtnTd{bottom:1px;}
		.xiugaizhongxin4.sbox .slable{width:15%;}
		.uploadexcelinput{cursor:pointer;top:0;position:absolute;left:97px;z-index:2;width:87px;height:32px;filter:alpha(opacity=0);-moz-opacity:0;-khtml-opacity: 0;opacity: 0; }
		.uploadexcelinput.type2{position:relative;left:0;width:72px;height:28px;filter:alpha(opacity=0);-moz-opacity:0;-khtml-opacity: 0;opacity: 0; }
		.infotextsay{line-height:25px;float:right;width:81%;display:inline-block;vertical-align:top;}
		
	</style>
</head>
<body class="xiangmuguanli xiangmujibenxinxi zhuantiguanli updownbody">

	<h4 class="zti_title">
		<a href="javascript:;" back="专题管理-基本信息.html" class="goback ztit_abtn">基本信息</a>
		<a href="javascript:;" back="专题管理-专题课程.html" class="goback ztit_abtn">专题课程</a>
		<a href="javascript:;" back="专题管理-人员管理.html" class="goback ztit_abtn active">人员管理</a>
	</h4>
	<div class="btn_div">
		<table class="search_table">
			<tr>
				<td>
					<span class="sear_lable">姓名/手机号</span>
					<input id="nameorphone" class="com_input com_input1" type="text" />
				</td>
				<td>
					<span class="sear_lable">部门</span>
					<select id="bumen" class="com_select com_select2">
						<option value="">请选择</option>
					</select>
				</td>
				<td>
					<span class="sear_lable">状态</span>
					<select id="zhuangtai" class="com_select com_select2">
						<option value="">请选择</option>
						<option value="有效">有效</option>
						<option value="已过期">已过期</option>
					</select>
				</td>
				<td>
					<span class="sear_lable">结束时间</span>
					<input class="com_input com_input3"  id="start_time0" placeholder="起" type="text" />
				</td>
			</tr>
			<tr>
				<td>
					<span class="sear_lable">结束时间</span>
					<input class="com_input com_input4" id="end_time0"  placeholder="止" type="text" />
				</td>
				<td>
					<span class="sear_lable">关联时间</span>
					<input class="com_input com_input3"  id="start_time1" placeholder="起" type="text" />
				</td>
				<td>
					<span class="sear_lable">关联时间</span>
					<input class="com_input com_input4" id="end_time1"  placeholder="止" type="text" />
				</td>
				<td>
					
				</td>
			</tr>
		</table>
		<span class="searBtnTd">
			<a id="searchBtn" class="top_btn xiangMu_xiangMuSouSuo">搜索</a>
			<a id="searchAll" class="top_btn type2">清空条件</a>
			<a class="upserBtn up" href="javascript:;" >收起</a>
		</span>
	</div>
	<div class="sline_tips">（已添加<span>40</span>人，<span class="c1">35</span>人可观看，<span class="c2">5</span>人已过期）</div>
	<div class="sear_line"></div>
	<div class="m_info">
		<!-- 项目总数：<span id="totalElements" class="m_value">0</span> -->
		<a class="daochuCommonBtn cao_btn cao_btn2" id="editall" >编辑</a>
		<a style="left:74px;" class="daochuCommonBtn cao_btn cao_btn3" id="delall" >删除</a>
		<a class="creat_forse at1" id="addfromtable" >导表添加</a>
		<a class="creat_forse at0" id="addit" >添加人员</a>
	</div>
	<div id="tableList1" class="table_div">
		<table class="table1">
			<tr>
				<th class="padding_s"><div class="check_box toAll"><i class="i"></i></div></th>
				<th style="min-width:30px;">编号</th>
				<th style="min-width:30px;">姓名</th>
				<th style="min-width:30px;">电话</th>
				<th style="min-width:30px;">部门</th>
				<th style="min-width:60px;">关联时间</th>
				<th style="min-width:60px;">结束时间</th>
				<th style="min-width:60px;">学习时长</th>
				<th style="min-width:90px;">课程学习进度</th>
				<th style="min-width:30px;">状态</th>
				<th style="min-width:60px;">操作</th>
			</tr>
			<tr>
				<td class="padding_s"><div class="check_box tocommon "><i class="i"></i></div></td>
				<td>009</td>
				<td>伊利娜</td>
				<td>18512334445</td>
				<td>稽查部</td>
				<td>2016/7/23 14：32：32</td>
				<td>2016/7/23 14：32：32</td>
				<td>14：32：32</td>
				<td style="line-height:20px;"><span class="pro_t">5/10</span><br><li class="pro_b"><i class="pro_w"></i></li></td>
				<td>正常</td>
				<td class="last">
					<a class="cao_btn cao_btn2">编辑</a>
					<a class="cao_btn cao_btn3">删除</a>
				</td>
			</tr>
		</table>
	</div>
	<div class="pages">
        <div id="Pagination"></div>
        <div style="display:none;"  class="searchPage">
          <span style="display:none;" class="page-sum">共<strong class="allPage">1</strong>页</span>
          <span class="page-sum">
			<select class="com_select pagesShow">
				<option value=10 >10条/页</option>
				<option value=30 >30条/页</option>
				<option value=50 >50条/页</option>
			</select>
		</span>
          <span class="page-go">跳转<input type="text">页</span>
          <a href="javascript:;" class="page-btn gogo">GO</a>
        </div>
    </div>
	
	<!-- 弹窗 -->
	<div info="弹窗背景" class="stip_bg"></div>
	<div info="弹窗容器" class="stip_box">
		<div class="stip_content">
			<!-- 编辑结束时间 -->
			<div class="sbox xiugaijieshushijian">
				<h4 class="sbox_h4">修改结束时间<a onclick="closeSbox()" class="close_x"></a></h4>
				<div class="sbox_c"><span class="slable">结束时间</span><i class="star"></i><input id="xsjieshushijian" class="sbox_input " type="text"/></div>
				
				<div class="sbox_btn_div" style="text-align:center;">
					<a href="javascript:;" id="noBtn4" onclick="closeSbox()" class="sbox_btn btn1">取消</a>
					<a id="yesBtn5" style="margin-left:25px;" href="javascript:;" class="sbox_btn btn2">确认</a>
				</div>
			</div>
			
			<!-- 导入excel弹窗 -->
			<div style="width:600px;" class="sbox xiugaizhongxin xiugaizhongxin4">
				<h4 class="sbox_h4">导表添加<a onclick="closeSbox()" class="close_x"></a></h4>
				<div class="sbox_c">
					<span class="slable">上传EXCEL</span>
					<div style="position:relative;">
						<a style="margin-left:25px;font-size:13px;background-color:#59BA73;border:1px solid #59BA73;" href="javascript:;" class="sbox_btn btn2">选择文件</a>
						<form enctype="multipart/form-data" method="post" class="uploadexcelinput" id="fileForm" name="fileForm">
							<input id="orderMaterialFile" name="discovery" class="uploadexcelinput type2" type="file" />
							<input name="taskId" id="taskvalue" type="hidden" />
						</form>	
						<span id="firenamestr"></span>
					</div>
				</div>
				<div style="margin-top:10px;" class="sbox_c"><span class="slable">说明</span><i class="star"></i>
					<p class="infotextsay">
						1、上传文件必须是.xlsx文件（大小不能超过5M）；<br/>
						2、每个Excel文件控制在200行以内；<br/>
						3、表头：姓名（选填）、电话（必填）<br/>
						4、<a href="javascript:;" id="downloadExcel">示例下载</a>
					</p>
				</div>
				<div class="sbox_btn_div" style="text-align:center;">
					<a href="javascript:;" id="noBtn4" onclick="closeSbox()" class="sbox_btn btn1">取消</a>
					<a id="yesBtn4" style="margin-left:25px;" href="javascript:;" class="sbox_btn btn2">导入</a>
				</div>
			</div>
			
			<!-- 添加人员 -->
			<div style="width:555px;" class="sbox tianjiarenyuan">
				<h4 style="margin-bottom:0;" class="sbox_h4">添加人员<span class="ss">（指定专题可见人员）</span><a onclick="closeSbox()" class="close_x"></a></h4>
				<div class="stdiv">
					<a href="javascript:;" class="staddbtn add" >添加 > </a>
					<a href="javascript:;" class="staddbtn del" > < 删除</a>
					<!-- 左侧 -->
					<div class="stpart left_st">
						<div class="serDiv"><input type="text" class="sesinput" /><a href="javascript:;" class="serabtn"></a></div>
						<div class="resdiv">
							<!-- <div class="peoone"><div class="check_box"><i class="i"></i>姓名&nbsp;&nbsp;13520848574</div></div>
							<div class="peoone"><div class="check_box"><i class="i"></i>姓名&nbsp;&nbsp;13520848574</div></div>
							<div class="peoone"><div class="check_box"><i class="i"></i>姓名&nbsp;&nbsp;13520848574</div></div> -->
						</div>
						<h4 class="peott">部门列表</h4>
						<div class="peodiv">
							<div class="floor">
								<div class="floor_tt"><div class="check_box"><i class="i"></i>企业全员（70人）</div></div>
								<div class="floor">
									<div class="floor_tt"><div class="check_box"><i class="i"></i>人事部（15人）</div></div>
									<div class="floor">
										<div class="peoone"><div class="check_box"><i class="i"></i><span class="mar">姓名1</span>13520848574</div></div>
									</div>
									<div class="floor">
										<div class="peoone"><div class="check_box"><i class="i"></i><span class="mar">姓名2</span>13520848574</div></div>
									</div>
									<div class="floor">
										<div class="peoone"><div class="check_box"><i class="i"></i><span class="mar">姓名3</span>13520848574</div></div>
									</div>
								</div>
								<div class="floor">
									<div class="floor_tt"><div class="check_box"><i class="i"></i>稽查部（15人）</div></div>
									<div class="floor">
										<div class="peoone"><div class="check_box"><i class="i"></i><span class="mar">姓名1</span>13520848574</div></div>
									</div>
									<div class="floor">
										<div class="peoone"><div class="check_box"><i class="i"></i><span class="mar">姓名4</span>13520848574</div></div>
									</div>
									<div class="floor">
										<div class="peoone"><div class="check_box"><i class="i"></i><span class="mar">姓名4</span>13520848574</div></div>
									</div>
									<div class="floor">
										<div class="peoone"><div class="check_box"><i class="i"></i><span class="mar">姓名4</span>13520848574</div></div>
									</div>
									<div class="floor">
										<div class="peoone"><div class="check_box"><i class="i"></i><span class="mar">姓名5</span>13520848574</div></div>
									</div>
								</div>
								<div class="floor">
									<div class="floor_tt"><div class="check_box"><i class="i"></i>行政部（15人）</div></div>
									<div class="floor">
										<div class="peoone"><div class="check_box"><i class="i"></i><span class="mar">姓名1</span>13520848574</div></div>
									</div>
									<div class="floor">
										<div class="peoone"><div class="check_box"><i class="i"></i><span class="mar">姓名1</span>13520848574</div></div>
									</div>
									<div class="floor">
										<div class="peoone"><div class="check_box"><i class="i"></i><span class="mar">姓名1</span>13520848574</div></div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- 右侧 -->
					<div class="stpart right_st">
						<div class="serDiv"><input type="text" class="sesinput" /><a href="javascript:;" class="serabtn"></a></div>
						<div class="resdiv">
							<!-- <div class="peoone"><div class="check_box"><i class="i"></i>姓名&nbsp;&nbsp;13520848574</div></div>
							<div class="peoone"><div class="check_box"><i class="i"></i>姓名&nbsp;&nbsp;13520848574</div></div>
							<div class="peoone"><div class="check_box"><i class="i"></i>姓名&nbsp;&nbsp;13520848574</div></div> -->
						</div>
						<h4 class="addtum"><div class="check_box"><i class="i"></i>已添加（<span id="addedNum">0</span>人）</div></h4>
						<div class="peodiv">
							<!-- <div class="peoone"><div class="check_box"><i class="i"></i><span class="mar">姓名1</span>13520848574</div></div>
							<div class="peoone"><div class="check_box"><i class="i"></i><span class="mar">姓名2</span>13520848574</div></div>
							<div class="peoone"><div class="check_box"><i class="i"></i><span class="mar">姓名3</span>13520848574</div></div> -->
						</div>
					</div>
					<!--  -->
				</div>
				<div class="sbox_btn_div" style="text-align:center;margin-top:0;">
					<a href="javascript:;" id="noBtn0" onclick="closeSbox()" class="sbox_btn btn1">取消</a>
					<a id="yesBtn0" style="margin-left:25px;" href="javascript:;" class="sbox_btn btn2">确认</a>
				</div>
			</div>
			
		</div>
	</div>	
	
	
	
	<script type="text/javascript" src="../public/libs/jquery.min.js"></script>
	<script type="text/javascript" src="../public/laydate/laydate.js"></script>
	<script type="text/javascript" src="../public/libs/json.js"></script>
	<script type="text/javascript" src="../public/libs/base.js"></script>
	<script type="text/javascript" src="../public/libs/layer.js"></script>
	<script type="text/javascript" src="../public/libs/utils.js"></script>
	<script type="text/javascript" src="../public/js/common2.js"></script>
</body>
<script>
$(function(){
	var g = {};
	g.login_token = Utils.offLineStore.get("token",false) || "";
	g.id = Utils.getQueryString("id") || "";//获取项目id
	g.do = Utils.getQueryString("do") || "";//获取操作 是查看（check）还是修改（change）新建 （new）
	g.httpTip = new Utils.httpTip({});
	g.totalPage = 1;//存总页数
	g.nowPage = 0;//存当前页 0 是第一页
	g.showPages = 10;//每页显示多少行
	g.loadPage = true;//判断页面刚加载一次 定义分页的地方用
	
/* **************************************** lodding ******************************************** */	
	//加载顶部标题
	$('#menu_show_t .ss',parent.document).removeClass('active').html('');
	$('#menu_show_t .s0',parent.document).css('cursor','pointer').html('专题管理').off().on('click',function(){
		parent.document.getElementById("iframeObj").src = '专题管理.html';
	});
	$('#menu_show_t .s1',parent.document).html(' > 人员管理').addClass('active');
	$('#searchAll').on('click',function(){g.nowPage = 0;tableListShow(2)});
	$('#searchBtn').on('click',function(){g.nowPage = 0;tableListShow(1)});
	$('#change_ok_btn').on('click',function(){changeOrCreateProject(1)});
	$('#addfromtable').on('click',function(){showSbox('.xiugaizhongxin4');});//导表添加
	$('#addit').on('click',function(){showSbox('.tianjiarenyuan');});//添加人员
	$('#editall').on('click',function(){showSbox('.xiugaijieshushijian');});//修改结束时间
	//showSbox('.tianjiarenyuan');
	subSomething();//加载进度条
/* **************************************** setTing ******************************************** */	
	
	//getProject();//获取项目信息
	
	//加载进度条
	function subSomething(){
		if(document.readyState == 'complete'){//页面加载完成
			$('.xiangmuguanli .pro_w').each(function(){
				var _this = $(this) || {};
				var _w1 = _this.parents('td').find('.pro_t').html() || '';
				var _w = _w1 == '' ? '0%' : parseInt(100*_w1.split('/')[0]/_w1.split('/')[1])+'%';
				_this.animate({'width':_w},'slow');
			});
		}
	}
	
	//修改保存项目信息
	function changeOrCreateProject(is){
		var is = is || '';//is 1 修改或保存 2 新建
		var sponsor_name = $('#sponsor_name').val() || '';
		var edithtml = g.editor.html() || '';
		console.log(g.editor.html());
		if(sponsor_name == ''){Utils.alert('不能为空！');return false;}
		var condi = {};
		condi.sponsor_name = sponsor_name;
		if(is != '2'){//保存
		condi.id = g.id;
		condi.audit_aim = audit_aim;
		condi.audit_scope = audit_scope;
		condi.audit_reference = audit_reference;
		condi.audit_module = audit_module;
		}
		var url = Base.serverUrl + "project/update";
		if(is == '2'){url = Base.serverUrl + "project/create"}
		$('#create_new_btn').off();
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var d = data.result || [];
					var tip = is != '2' ? '保存成功！' : '新建成功！' ;
					Utils.alert(tip);
					if(is == '2'){//新建项目
						setTimeout(function(){
							parent.document.getElementById("iframeObj").src = '专题管理.html';
						},1000);
					}
				}
				else{
					var msg = data.message || "保存失败";
					Utils.alert(msg);
					$('#create_new_btn').on('click',function(){changeOrCreateProject(2)});
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				$('#create_new_btn').on('click',function(){changeOrCreateProject(2)});
				if(status=='timeout'){
		　　　　　  Utils.alert("超时");
		　　　　}
			}
		});
	}	
	
	//获取项目信息
	function getProject(){
		var condi = {};
		condi.id = g.id;
		var url = Base.serverUrl + "project/edit";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var d = data.result || [];
					var id = d.id || '';
					$('#sponsor_name').val(d.sponsor_name || '');
					
				}
				else{
					var msg = data.message || "获取项目信息失败";
					Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  Utils.alert("超时");
		　　　　}
			}
		});
	}

	//加载时间控件
	var start = {
	  elem: '#start_time0',
	  format: 'YYYY-MM-DD hh:mm:ss',
	  //min: laydate.now(), //设定最小日期为当前日期
	  max: '2099-06-16', //最大日期
	  istime: true,
	  istoday: false,
	  choose: function(datas){
		 //end.min = datas; //开始日选好后，重置结束日的最小日期
		 //end.start = datas //将结束日的初始值设定为开始日
	  }
	};
	var end = {
	  elem: '#end_time0',
	  format: 'YYYY-MM-DD hh:mm:ss',
	  //min: laydate.now(),
	  max: '2099-06-16',
	  istime: true,
	  istoday: false,
	  choose: function(datas){
		start.max = datas; //结束日选好后，重置开始日的最大日期
	  }
	};
		//加载时间控件
	var start1 = {
	  elem: '#start_time1',
	  format: 'YYYY-MM-DD hh:mm:ss',
	  //min: laydate.now(), //设定最小日期为当前日期
	  max: '2099-06-16', //最大日期
	  istime: true,
	  istoday: false,
	  choose: function(datas){
		 //end.min = datas; //开始日选好后，重置结束日的最小日期
		 //end.start = datas //将结束日的初始值设定为开始日
	  }
	};
	var end1 = {
	  elem: '#end_time1',
	  format: 'YYYY-MM-DD hh:mm:ss',
	  //min: laydate.now(),
	  max: '2099-06-16',
	  istime: true,
	  istoday: false,
	  choose: function(datas){
		start.max = datas; //结束日选好后，重置开始日的最大日期
	  }
	};
	var end2 = {
	  elem: '#xsjieshushijian',
	  format: 'YYYY-MM-DD hh:mm:ss',
	  //min: laydate.now(),
	  max: '2099-06-16',
	  istime: true,
	  istoday: false,
	  choose: function(datas){
		start.max = datas; //结束日选好后，重置开始日的最大日期
	  }
	};
	laydate(start);
	laydate(end);
	laydate(start1);
	laydate(end1);
	laydate(end2);
	
	
	
});

</script>
</html>
<!doctype html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<meta content="IE=Edge,chrome=1" http-equiv="X-UA-Compatible">
	<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
	<meta content="yes" name="apple-mobile-web-app-capable">
	<meta content="black" name="apple-mobile-web-app-status-bar-style">
	<meta name="format-detection" content="telephone=no"/>
	<link rel="stylesheet" href="../public/select2/css/select2.min.css" />
	<link rel="stylesheet" href="../public/css/common.css" />
	<title></title>
	<style>
		.check_box .i, .check_box2 .i{margin-right:5px;}
		.xiangmujibenxinxi .lable{width:200px;}
	</style>
</head>
<body class="xiangmuguanli xiangmujibenxinxi">
<!-- 客户名称 -->
	<ul style="width:356px;" class="choiseDanwei choiseDanwei4">
		<li>加载失败</li>
	</ul>
	<ul style="width:356px;" class="choiseDanwei choiseDanwei5">
		<li>加载失败</li>
	</ul>
	<div class="content_box1">

		<div class="con_d"><span class="lable need">任务名称</span><i class="x">*</i><input id="name" class="common_input" type="text" /></div>
		<div class="con_d"><span class="lable need">企业类型</span><i class="x">*</i><select id="companyType" class="common_select">
				<option value="">请选择</option>
				<option value="合伙企业">合伙企业</option>
				<option value="有限公司">有限公司</option>
				<option value="个体企业">个体企业</option>
			</select>
		</div>
		<div class="con_d"><span class="lable need">园区</span><i class="x">*</i><select id="parkName" class="common_select">
				<option value="">请选择</option>
			</select>
		</div>
		<div class="con_d con2"><span class="lable need">注册地址段</span><i class="x">*</i><input id="regAddress" placeholder="系统默认带出，可修改，要判重" class="common_input" type="text" /></div>
		<div class="con_d"><span class="lable need">注册资本</span><i class="x">*</i><input id="regAmountCapital" class="common_input" type="text" /></div>
		<div class="con_d"><span class="lable need">法人姓名</span><i class="x">*</i><input id="legalPersonName" class="common_input" type="text" /></div>
		<div class="con_d"><span class="lable need">法人身份证</span><i class="x">*</i><input id="legalPersonIDCard" class="common_input" type="text" /></div>
		<div class="con_d"><span class="lable need">上传身份证图片<br>(正反面)</span><i class="x">*</i>
			<div class="head_img_spam">
				<i info="放大图" class="hide_head_imgs"></i>
				<div info="放大图背景" class="head_img_bg"></div>
				<i info="原图" class="head_imgs"></i>
				<div info="上传后提示背景" class="head_img_tips_bg"></div>
				<div info="上传后提示" id="legalPersonIDCardPic1" class="head_img_tips">重新上传</div>
			</div>
			<div class="head_img_spam">
				<i info="放大图" class="hide_head_imgs"></i>
				<div info="放大图背景" class="head_img_bg"></div>
				<i info="原图" class="head_imgs"></i>
				<div info="上传后提示背景" class="head_img_tips_bg"></div>
				<div info="上传后提示" id="legalPersonIDCardPic2" class="head_img_tips">重新上传</div>
			</div>
		</div>
		<div class="con_d"><span class="lable need">法人手机号</span><i class="x">*</i><input id="legalPersonPhone" class="common_input" type="text" /></div>
		<div class="con_d"><span class="lable need">联系人姓名</span><i class="x">*</i><input id="contactsName" class="common_input" type="text" /></div>
		<div class="con_d"><span class="lable need">联系人电话</span><i class="x">*</i><input id="contactsPhone" class="common_input" type="text" /></div>
		<div class="con_d"><span class="lable need">财务负责人姓名</span><i class="x">*</i><input id="financialOfficer" class="common_input" type="text" /></div>
		<div class="con_d"><span class="lable need">财务负责人身份证</span><i class="x">*</i><input id="financialOfficerIDCard" class="common_input" type="text" /></div>
		<div class="con_d" ><span class="lable need">上传身份证图片<br>(正反面)</span><i class="x">*</i>
			<div class="head_img_spam">
				<i info="放大图" class="hide_head_imgs"></i>
				<div info="放大图背景" class="head_img_bg"></div>
				<i info="原图" class="head_imgs"></i>
				<div info="上传后提示背景" class="head_img_tips_bg"></div>
				<div info="上传后提示" id="financialOfficerIDCardPic1" class="head_img_tips">重新上传</div>
			</div>
			<div class="head_img_spam">
				<i info="放大图" class="hide_head_imgs"></i>
				<div info="放大图背景" class="head_img_bg"></div>
				<i info="原图" class="head_imgs"></i>
				<div info="上传后提示背景" class="head_img_tips_bg"></div>
				<div info="上传后提示" id="financialOfficerIDCardPic2" class="head_img_tips">重新上传</div>
			</div>
		</div>
		<div class="con_d"><span class="lable need">财务负责人手机号</span><i class="x">*</i><input id="financialOfficerPhone" class="common_input" type="text" /></div>
		<div class="con_d"><span class="lable need">身份证回寄地址、电话、接收人</span><i class="x">*</i><textarea id="idCardMailAddress" class="common_textarea"></textarea></div>
		<div class="con_d no_con_d kezhangdivc"><span class="lable need">刻章信息</span><i class="x"></i>
			<div id="gongzhang" val=46 class="check_box active"><i class="i"></i>公章（<span>46</span>）</div>
			<div id="farenzhang" val=32 class="check_box active"><i class="i"></i>法人章（<span>32</span>）</div>
			<div id="caiwuzhang" val=32 class="check_box"><i class="i"></i>财务章（<span>32</span>）</div>
			<div id="hetongzhang" val=32 class="check_box"><i class="i"></i>合同章（<span>32</span>）</div>
			<div id="fapiaozhang" val=32 class="check_box"><i class="i"></i>发票章（<span>32</span>）</div>
			<span style="color:#D0011B;">刻章费用总计<i id="totalzhang">0</i></span>
		</div>
		<div class="con_d con2"><span class="lable need">首次领取发票信息</span><i class="x">*</i>
			<table class="fapiaotable">
				<tr><th>发票类型</th><th>面额（万元）</th><th>张数（张）</th></tr>
				<tr>
					<td>普通电子发票</td>
					<td><select id="elecDenomination" class="common_select fapiaojine1"><option value="1">1</option><option value="10">10</option><option value="100">100</option></select></td>
					<td><input id="elecNum" class="common_input fapiaozhangshu1" type="text" /></td>
				</tr>
				<tr>
					<td>普通纸质发票</td>
					<td><select id="paperDenomination" class="common_select fapiaojine2"><option value="1">1</option><option value="10">10</option><option value="100">100</option></select></td>
					<td><input id="paperNum" class="common_input fapiaozhangshu2" type="text" /></td>
				</tr>
				<tr>
					<td>专票纸质发票</td>
					<td><select id="special_denomination" class="common_select fapiaojine3"><option value="1">1</option><option value="10">10</option><option value="100">100</option></select></td>
					<td><input id="specialNum" class="common_input fapiaozhangshu3" type="text" /></td>
				</tr>
			</table>
		</div>
		<div class="con_d no_con_d creat_hide"><span class="lable need">客户快递单号</span><i class="x">*</i><input id="expressNum" class="common_input" type="text" /></div>
		<div class="con_d no_con_d creat_hide"><span class="lable need">快递寄出时间</span><i class="x">*</i><input id="expressTime" class="common_input" type="text" />
		<a href="javascript:;" id="jichuabtn" style="float:none;margin-left:12px;vertical-align:middle;" class="creat_forse">确认寄出</a>
		</div>
		
		<div id="new_create_btn" class="btns_div"><a back='项目任务.html' class="common_abtn goback type1">取消</a><a href="javascript:;" id="create_new_btn" class="common_abtn type2">确认</a></div>
	</div>

	<!-- 弹窗 -->
	<div info="弹窗背景" class="stip_bg"></div>
	<div info="弹窗容器" class="stip_box">
		<div class="stip_content">
			
			<div class="sbox xiugaizhongxin kuaidiSbox">
				<h4 class="sbox_h4">快递信息</h4>
				<!-- <div class="sbox_c"><span class="slable">编号</span><i class="star"></i><input id="code" class="sbox_input" type="text"/></div> -->
				<div class="sbox_c"><span class="slable">快递原因</span><i class="star">*</i><input id="reason" class="sbox_input" type="text"/></div>
				<div class="sbox_c"><span class="slable">快递物品</span><i class="star">*</i><input id="goods" class="sbox_input" type="text"/></div>
				<div class="sbox_c"><span class="slable">发件人</span><i class="star">*</i><input id="sendName" class="sbox_input" type="text"/></div>
				<div class="sbox_c"><span class="slable">发件信息</span><i class="star">*</i><input id="sendInfo" class="sbox_input" type="text"/></div>
				<div class="sbox_c"><span class="slable">收件人</span><i class="star">*</i><input id="receiver" class="sbox_input" type="text"/></div>
				<div class="sbox_c"><span class="slable">收件信息</span><i class="star">*</i><input id="receiverInfo" class="sbox_input" type="text"/></div>
				<div class="sbox_c"><span class="slable">客户快递单号</span><i class="star">*</i><input id="expressNum" class="sbox_input" type="text"/></div>
				<div class="sbox_c"><span class="slable">备注</span><i class="star"></i><textarea id="remark" style="height:35px;" class="sbox_input"></textarea></div>
				<div class="sbox_btn_div">
					<a href="javascript:;" id="noBtn3" onclick="closeSbox()" class="sbox_btn btn1">取消</a>
					<a id="yesBtn3" href="javascript:;" class="sbox_btn btn2">确认</a>
				</div>
			</div>

		</div>
	</div>
	
	
	<script type="text/javascript" src="../public/libs/jquery.min.js"></script>
	<script type="text/javascript" src="../public/laydate/laydate.js"></script>
	<script type="text/javascript" src="../public/libs/json.js"></script>
	<script type="text/javascript" src="../public/libs/base.js"></script>
	<script type="text/javascript" src="../public/libs/layer.js"></script>
	<script type="text/javascript" src="../public/libs/qiniu.min.js"></script>
	<script type="text/javascript" src="../public/libs/utils.js"></script>
	<script type="text/javascript" src="../public/js/common2.js"></script>
	
</body>
<script>
$(function(){
	var g = {};
	g.login_token = Utils.offLineStore.get("token",false) || "";
	g.id = Utils.getQueryString("id") || "";//获取任务id
	g.xid = Utils.getQueryString("xid") || Utils.offLineStore.get("xid",false);//获取项目id
	g.do = Utils.getQueryString("do") || "";//获取操作 是查看（check）还是修改（change）新建 （new）
	g.httpTip = new Utils.httpTip({});
	g.totalPage = 1;//存总页数
	g.nowPage = 0;//存当前页 0 是第一页
	g.showPages = 10;//每页显示多少行
	g.loadPage = true;//判断页面刚加载一次 定义分页的地方用
	g.ids = [];//存储当前所有项目id及其状态
	g.quanxuan = 0;
	
/* **************************************** lodding ******************************************** */	
	//加载顶部标题
	$('#menu_show_t .ss',parent.document).removeClass('active').html('');
	$('#menu_show_t .s0',parent.document).css('cursor','pointer').html('项目管理').off().on('click',function(){
		parent.document.getElementById("iframeObj").src = '项目管理.html';
	});
	$('#menu_show_t .s1',parent.document).css('cursor','pointer').html(' > 项目任务').off().on('click',function(){
		parent.document.getElementById("iframeObj").src = '项目任务.html';
	});
	$('#menu_show_t .s2',parent.document).html(' > 任务基本信息').addClass('active');
	
	
	$('#jichuabtn').on('click',getSboxedit);//确认寄出
	
	uploadToQiniu('legalPersonIDCardPic1');//定义七牛云上传
	uploadToQiniu('legalPersonIDCardPic2');//定义七牛云上传
	uploadToQiniu('financialOfficerIDCardPic1');//定义七牛云上传
	uploadToQiniu('financialOfficerIDCardPic2');//定义七牛云上传
/* **************************************** setTing ******************************************** */	
	
	loadCheck();//判断编辑还是查看

	
	//判断是编辑还是查看
	function loadCheck(){
		getShenBanFang();//获取客户名称列表
		getyuanqulist();//获取 园区列表
		if(g.do == 'change'){//修改
			$('.creat_hide').show();//显示寄出
			setTimeout(function(){
				getProject();//获取项目信息
			},200);
			
			$('#create_new_btn').on('click',function(){changeOrCreateProject(1)});
		}else if(g.do == 'new'){//新建
			compareMoney();//计算刻章费用
			$('#create_new_btn').on('click',function(){changeOrCreateProject(2)});
		}
	}
	
	$('.kezhangdivc').find('.check_box').on('click',function(){
		setTimeout(function(){
			compareMoney();//计算刻章费用
		},100);
	})
	
	//初始化弹窗
	function reloadSbox(){
		$('.xiugaizhongxin input,.xiugaizhongxin textarea').val('');//清空弹窗
		$('.xiugaizhongxin select').val('');//清空弹窗
		$('#noBtn').html('取消');
		$('#yesBtn').off().show();
		$('.xiugaizhongxin input').removeAttr('readonly').removeClass('readonly');//清空
		$('.xiugaizhongxin select').removeAttr('disabled').removeClass('readonly');//清空
	}	
	//加载弹窗信息
	function getSboxedit(is){
		if(!confirm('确认寄出吗？')){return false;}
		var expressNum = $('#expressNum').val() || '';
		var expressTime = $('#expressTime').val() || '';
		if(expressNum == ''){Utils.alert('客户快递单号不能为空！');return false;}
		if(expressTime == ''){Utils.alert('快递寄出时间不能为空！');return false;}
		var is = is || '';
		var condi = {};
		condi.id = g.id;
		condi.expressNum = expressNum;
		condi.expressTime = expressTime;
		var url = Base.serverUrl + "landingTask/send/off/before";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"GET",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var d = data.result || {};
					
					reloadSbox();//初始化弹窗
					//赋值
					setCondiVal(d,'.xiugaizhongxin','.sbox_c');
					
					//弹窗
					var tips = '';//判断弹窗标题
					tips = '快递信息';
					$('#yesBtn3').off().on('click',function(){centerFunc('change',d.id || '')});
					$('.xiugaizhongxin .sbox_h4').html(tips);
					showSbox('.xiugaizhongxin');//显示弹窗
				}
				else{
					var msg = data.message || "删除失败";
					Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  Utils.alert("超时");
		　　　　}
			}
		});
	}

	//新建
	window.centerFunc = function(is,id){
		var is = is || '';
		var id = id || '';
		$('#yesBtn3').off();
		var condi = {};
		condi.taskId  = g.id;
		condi = setInfoCondi(condi,'.xiugaizhongxin','.sbox_c');
		if(condi == false){return false;}
		var url = Base.serverUrl + "express/create";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"GET",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var tips = '新增成功！';
					Utils.alert(tips);
					closeSbox();//关闭弹窗
					jichuabtnFunc();//确认寄出
				}
				else{
					var msg = data.message || "获取信息失败";
					Utils.alert(msg);
				}
				$('#yesBtn3').off().on('click',function(){centerFunc(is)});
			},
			error:function(data,status){
				//g.httpTip.hide();
				$('#yesBtn3').off().on('click',function(){centerFunc(is)});
				if(status=='timeout'){
		　　　　　  //Utils.alert("超时");
		　　　　}
			}
		});
	}
	 
	//计算刻章费用
	function compareMoney(){
		var tmoney = 0;
		$('.kezhangdivc').find('.check_box').each(function(){
			var val = parseInt($(this).attr('val') || '0');
			if($(this).hasClass('active')){tmoney += val;}
		});
		$('#totalzhang').html(tmoney);
	}
	
	//确认寄出
	function jichuabtnFunc(){

		var expressNum = $('#expressNum').val() || '';
		var expressTime = $('#expressTime').val() || '';
		var condi = {};
		condi.id = g.id;
		condi.expressNum = expressNum;
		condi.expressTime = expressTime;
		var url = Base.serverUrl + "landingTask/send/off";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					Utils.alert('寄出成功！');
				}
				else{
					var msg = data.message || "失败";
					Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  Utils.alert("超时");
		　　　　}
			}
		});
	}
	
	
	//获取 园区列表
	function getyuanqulist(){
		var condi = {};
		condi.number = 1000;//每页显示行数
		var url = Base.serverUrl + "park/search";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var data = data.result || [];
					var data = data.content || [];
					var html = '<option value="">请选择</option>';
					for(var i=0,len=data.length;i<len;i++){
						var d = data[i] || [];
						var id = d.id || '';
						var name = d.name || '';
						var regAddress = d.regAddress || '';
						html += '<option aid="'+id+'" value="'+name+'">'+name+'</option>';
					}
					$('#parkName').html(html);
				}
				else{
					var msg = data.message || "失败";
					//Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  Utils.alert("超时");
		　　　　}
			}
		});
	}
	//注册地址段赋值
	$('#parkName').change(function(){
		var id = $("#parkName").find("option:selected").attr('aid') || '';
		$('#parkName').attr('tipid',id);
		var condi = {};
		condi.id = id;
		var url = Base.serverUrl + "park/edit";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var d = data.result || [];
					setCondiVal(d,'.content_box1','.con2');//给输入框 赋值
					$('#special_denomination').val(d.specialDenomination || '');
					$('#gongzhang').attr('val',d.gongzhang || '').find('span').html(d.gongzhang || '');
					$('#farenzhang').attr('val',d.farenzhang || '').find('span').html(d.farenzhang || '');
					$('#caiwuzhang').attr('val',d.caiwuzhang || '').find('span').html(d.caiwuzhang || '');
					$('#hetongzhang').attr('val',d.hetongzhang || '').find('span').html(d.hetongzhang || '');
					$('#fapiaozhang').attr('val',d.fapiaozhang || '').find('span').html(d.fapiaozhang || '');
					compareMoney();//计算刻章费用
				}
				else{
					var msg = data.message || "获取项目信息失败";
					Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  Utils.alert("超时");
		　　　　}
			}
		});
	});

	
	//修改保存项目信息
	function changeOrCreateProject(is){
		var is = is || '';//is 1 修改或保存 2 新建
		
		var zhang = '' ,zhangState = '';
		$('.kezhangdivc').find('.check_box').each(function(){
			var _active = $(this).hasClass('active') ? 'active' : '';
			var _val = $(this).attr('val') || '';
			zhang = zhang == '' ? _val : zhang +','+ _val;
			zhangState = zhangState == '' ? _active : zhangState +','+ _active;
		});
		
		var totalzhang = $('#totalzhang').html() || '';
		var parkId = $('#parkName').attr('tipid') || '';
		var expressNum = $('#expressNum').val() || '';
		var expressTime = $('#expressTime').val() || '';
		var condi = {};
		condi = setInfoCondi(condi,'.content_box1');//传值和校验
		if(condi == false){return false;}
		condi.projectId = g.xid;
		condi.zhang = zhang;
		condi.zhangState = zhangState;
		condi.totalzhang = totalzhang;
		condi.expressNum = expressNum;
		condi.expressTime = expressTime;
		condi.parkId = parkId;
		var url = Base.serverUrl + "landingTask/update";
		if(is == '1'){condi.id = g.id;}
		if(is == '2'){url = Base.serverUrl + "landingTask/create"}
		$('#create_new_btn').off();
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var d = data.result || [];
					var tip = is != '2' ? '保存成功！' : '新建成功！' ;
					Utils.alert(tip);
					if(is == '2'){//新建项目
						setTimeout(function(){
							parent.document.getElementById("iframeObj").src = '项目任务.html';
						},1000);
					}
				}
				else{
					var msg = data.message || "保存失败";
					Utils.alert(msg);
					
				}
				//g.httpTip.hide();
				$('#create_new_btn').on('click',function(){changeOrCreateProject(is)});
			},
			error:function(data,status){
				//g.httpTip.hide();
				$('#create_new_btn').on('click',function(){changeOrCreateProject(is)});
				if(status=='timeout'){
		　　　　　  Utils.alert("超时");
		　　　　}
			}
		});
	}	
	
	//获取项目信息
	function getProject(){
		var condi = {};
		condi.id = g.id;
		var url = Base.serverUrl + "landingTask/edit";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var d = data.result || [];
					setCondiVal(d,'.content_box1');//给输入框 赋值
					$('#parkName').attr('tipid',d.parkId || '');
					
					var zhang = d.zhang || '';
					var zhangState = d.zhangState || '';
					var zarray = zhang.split(',') || [];
					var szarray = zhangState.split(',') || [];
					//刻章
					$('.kezhangdivc').find('.check_box').each(function(n){
						var _active = szarray[n] || '';
						var _val = zarray[n] || '';
						if(_active == ''){$(this).removeClass('active');}
						else{$(this).addClass('active');}
						$(this).attr('val',_val).find('span').html(_val);
					});
					$('#expressNum').val(d.expressNum || '');
					var expressTime = getDate(d.expressTime || '');
					$('#expressTime').val(expressTime);
					compareMoney();//计算刻章费用
				}
				else{
					var msg = data.message || "获取项目信息失败";
					Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  Utils.alert("超时");
		　　　　}
			}
		});
	}
	
			
	//输入时搜索客户名称
	$("#receiver").keyup(function(){
		var _vth = $(this);
		var _li = $('.choiseDanwei4 li');
		var _val = _vth.val() || '';
		if(_val == '' || _li.length <= 0){return false;}
		_li.show();
		_li.each(function(){//循环搜索
			var _tt = $(this);
			var _val2 = _tt.html() || '';
			var _if = _val2.indexOf(_val);
			if(_if <= -1){//不符合
				_tt.hide();
			}else{_tt.show();}
		});
	});
	//输入时搜索客户名称
	$("#sendName").keyup(function(){
		var _vth = $(this);
		var _li = $('.choiseDanwei5 li');
		var _val = _vth.val() || '';
		if(_val == '' || _li.length <= 0){return false;}
		_li.show();
		_li.each(function(){//循环搜索
			var _tt = $(this);
			var _val2 = _tt.html() || '';
			var _if = _val2.indexOf(_val);
			if(_if <= -1){//不符合
				_tt.hide();
			}else{_tt.show();}
		});
	});
	
	
	//选择客户
	$("#sendName").click(function(e){
		var _is = $(this);
		var xx = _is.offset().left || 0;
        var yy = _is.offset().top || 0;
		var _top = yy + _is.height() -9;
        $('.choiseDanwei5 li').show();
		$('.choiseDanwei').hide();
		$('.choiseDanwei5').show().css({"left":xx,"top":_top});
		$('.choiseDanwei5 li').on('click',function(e){
			var _tis = $(this);
			var _vdan= _tis.html() || '';
			var _vtip= _tis.attr('tip') || '';
			var str= _tis.attr('str') || '';
			_is.val(_vdan);
			_is.attr('tip',_vtip);
			$('#sendInfo').val(str);
			_tis.parents('.choiseDanwei').hide();
			stopPropagation(e);
		});
		stopPropagation(e);
    });
	$("#receiver").click(function(e){
		var _is = $(this);
		var xx = _is.offset().left || 0;
        var yy = _is.offset().top || 0;
		var _top = yy + _is.height() -9;
        $('.choiseDanwei4 li').show();
		$('.choiseDanwei').hide();
		$('.choiseDanwei4').show().css({"left":xx,"top":_top});
		$('.choiseDanwei4 li').on('click',function(e){
			var _tis = $(this);
			var _vdan= _tis.html() || '';
			var _vtip= _tis.attr('tip') || '';
			var str= _tis.attr('str') || '';
			_is.val(_vdan);
			_is.attr('tip',_vtip);
			$('#receiverInfo').val(str);
			_tis.parents('.choiseDanwei').hide();
			stopPropagation(e);
		});
		stopPropagation(e);
    });
	
	
	//获取客户名称列表
	function getShenBanFang(){
		var condi = {};
		condi.number = 1000;//每页显示行数
		var url = Base.serverUrl + "customer/search";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var data = data.result || [];
					var data = data.content || [];
					var html = '';
					for(var i=0,len=data.length;i<len;i++){
						var d = data[i] || [];
						var id = d.id || '';
						var name = d.name || '';
						var invoiceMailingAddress = d.invoiceMailingAddress || '';//邮寄地址
						var invoiceReceiverPhone = d.invoiceReceiverPhone || '';//收件人电话
						var invoiceReceiver = d.invoiceReceiver || '';//收件人
						var iiistr = '邮寄地址:'+invoiceMailingAddress+';'+'收件人:'+invoiceReceiver+';'+'收件人电话:'+invoiceReceiverPhone+';';
						html += '<li str="'+iiistr+'"  tip="'+id+'">'+name+'</li>';
					}
					$('.choiseDanwei4').html(html);
					$('.choiseDanwei5').html(html);
				}
				else{
					var msg = data.message || "登录失败";
					Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  Utils.alert("超时");
		　　　　}
			}
		});
	}
	
	
	//加载时间控件
	var timeControl1 = {
	  elem: '#expressTime',
	  format: 'YYYY-MM-DD',
	  //min: laydate.now(), //设定最小日期为当前日期
	  max: '2099-06-16', //最大日期
	  istime: true,
	  istoday: false,
	  choose: function(datas){
		 //end.min = datas; //开始日选好后，重置结束日的最小日期
		 //end.start = datas //将结束日的初始值设定为开始日
	  }
	};
	laydate(timeControl1);	
	
	
});

</script>
</html>
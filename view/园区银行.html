<!doctype html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	<meta content="IE=Edge,chrome=1" http-equiv="X-UA-Compatible">
	<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
	<meta content="yes" name="apple-mobile-web-app-capable">
	<meta content="black" name="apple-mobile-web-app-status-bar-style">
	<meta name="format-detection" content="telephone=no"/>
	<link rel="stylesheet" href="../public/select2/css/select2.min.css" />
	<link rel="stylesheet" href="../public/css/pagination.css" />
	<link rel="stylesheet" href="../public/css/common.css" />
	<link rel="stylesheet" href="../public/btncss/normalize.css" />
	<link rel="stylesheet" href="../public/btncss/vicons-font.css" />
	<!-- <link rel="stylesheet" href="../public/btncss/base.css" /> -->
	<link rel="stylesheet" href="../public/btncss/buttons.css" />
	<title></title>
	<style>
		.choiseDanwei21,.choiseDanwei22{margin-top:4px;width:286px;}
		.xiangmuguanli .table1 tr th{line-height:20px;}
		.sbox .sbox_input, .sbox .sbox_select{height:22px;line-height:22px;margin-bottom:1px;}
		.stip_box .sbox{padding:0 0 3px;}
	</style>
</head>
<body class="xiangmuguanli xiangmurenwu">
	<div class="m_info">
		<a class="creat_forse" style="float:none;" id="newCenter" >添加银行</a>
	</div>
	<div id="tableList" class="table_div">
		<!-- <table class="table1">
			<tr>
				<th style="min-width:26px;">编号</th>
				<th style="min-width:65px;">开户行名称</th>
				<th style="min-width:26px;">电话</th>
				<th style="min-width:52px;">U盾数量</th>
				<th style="min-width:52px;">初始密码</th>
				<th style="min-width:65px;">公对公和公对私转账限额</th>
				<th style="min-width:39px;">开户费</th>
				<th style="min-width:65px;">密码器费用</th>
				<th style="min-width:78px;">网银U盾费用</th>
				<th style="min-width:52px;">网银年费</th>
				<th style="min-width:52px;">账户年费</th>
				<th style="min-width:78px;">短信提示年费</th>
				<th style="min-width:26px;">备注</th>
				<th style="min-width:152px;">操作</th>
			</tr>
			<tr>
				<td>P001-01</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td class="last">
					<a class="cao_btn cao_btn2">编辑</a>
					<a class="cao_btn cao_btn3">删除</a>
				</td>
			</tr>
			<tr>
				<td>P001-02</td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td></td>
				<td class="last">
					<a class="cao_btn cao_btn2">编辑</a>
					<a class="cao_btn cao_btn3">删除</a>
				</td>
			</tr>
		</table> -->
	</div>
	<!-- <div class="pages">
        <div id="Pagination"></div>
        <div class="searchPage">
          <span style="display:none;" class="page-sum">共<strong class="allPage">1</strong>页</span>
          <span class="page-sum">
			<select class="com_select pagesShow">
				<option value=10 >10条/页</option>
				<option value=30 >30条/页</option>
				<option value=50 >50条/页</option>
			</select>
		</span>
          <span class="page-go">跳转<input type="text">页</span>
          <a href="javascript:;" class="page-btn gogo">GO</a>
        </div>
    </div> -->
	
	<!-- 弹窗 -->
	<div info="弹窗背景" class="stip_bg"></div>
	<div info="弹窗容器" class="stip_box">
		<div class="stip_content">
			
			<div class="sbox xiugaizhongxin">
				<h4 class="sbox_h4">银行信息</h4>
				<!-- <div class="sbox_c"><span class="slable">编号</span><i class="star"></i><input id="code" class="sbox_input" type="text"/></div> -->
				<div class="sbox_c"><span class="slable">开户行名称</span><i class="star">*</i><input id="name" class="sbox_input" type="text"/></div>
				<div class="sbox_c"><span class="slable">电话</span><i class="star">*</i><input id="phone" class="sbox_input" type="text"/></div>
				<div class="sbox_c"><span class="slable">U盾数量</span><i class="star">*</i><input id="unumber" class="sbox_input" type="text"/></div>
				<div class="sbox_c"><span class="slable">初始密码</span><i class="star">*</i><input id="initPassword" class="sbox_input" type="text"/></div>
				<div class="sbox_c"><span class="slable">公对公和公对私转账限额</span><i class="star">*</i><input id="pta" class="sbox_input" type="text"/></div>
				<div class="sbox_c"><span class="slable">开户费</span><i class="star">*</i><input id="openFee" class="sbox_input" type="text"/></div>
				<div class="sbox_c"><span class="slable">密码器费用</span><i class="star">*</i><input id="cipherFee" class="sbox_input" type="text"/></div>
				<div class="sbox_c"><span class="slable">网银U盾费用</span><i class="star">*</i><input id="ufee" class="sbox_input" type="text"/></div>
				<div class="sbox_c"><span class="slable">网银年费</span><i class="star">*</i><input id="onlineBankFee" class="sbox_input" type="text"/></div>
				<div class="sbox_c"><span class="slable">账户年费</span><i class="star">*</i><input id="accountFee" class="sbox_input" type="text"/></div>
				<div class="sbox_c"><span class="slable">短信提示年费</span><i class="star">*</i><input id="smsFee" class="sbox_input" type="text"/></div>
				<div class="sbox_c"><span class="slable">备注</span><i class="star"></i><textarea id="remark" style="height:35px;" class="sbox_input"></textarea></div>
				<div class="sbox_btn_div">
					<a href="javascript:;" id="noBtn" onclick="closeSbox()" class="sbox_btn btn1">取消</a>
					<a id="yesBtn" href="javascript:;" class="sbox_btn btn2">确认</a>
				</div>
			</div>

		</div>
	</div>
	
	
	
	<script type="text/javascript" src="../public/libs/jquery.min.js"></script>
	<script type="text/javascript" src="../public/laydate/laydate.js"></script>
	<script type="text/javascript" src="../public/libs/json.js"></script>
	<script type="text/javascript" src="../public/libs/base.js"></script>
	<script type="text/javascript" src="../public/libs/layer.js"></script>
	<script type="text/javascript" src="../public/libs/utils.js"></script>
	<script type="text/javascript" src="../public/js/common2.js"></script>
	<script type="text/javascript" src="../public/libs/jquery.pagination.js"></script>
	
</body>
<script>
$(function(){
	var g = {};
	g.login_token = Utils.offLineStore.get("token",false) || "";
	g.id = Utils.getQueryString("id");//从项目管理传来 项目id
	g.httpTip = new Utils.httpTip({});
	g.totalPage = 1;//存总页数
	g.nowPage = 0;//存当前页 0 是第一页
	g.showPages = 10;//每页显示多少行
	g.loadPage = true;//判断页面刚加载一次 定义分页的地方用
	
/* **************************************** lodding ******************************************** */		

	//加载顶部标题
	$('#menu_show_t .ss',parent.document).removeClass('active').html('');
	$('#menu_show_t .s0',parent.document).css('cursor','pointer').html('园区管理').off().on('click',function(){
		parent.document.getElementById("iframeObj").src = '园区管理.html';
	});
	$('#menu_show_t .s1',parent.document).html(' > 园区银行').addClass('active');
	$('#newCenter').on('click',function(){shownewCenterSbox('new')});
	tableListShow();//显示列表
	
/* **************************************** setTing ******************************************** */	
	
	//初始化弹窗
	function reloadSbox(){
		$('.xiugaizhongxin input,.xiugaizhongxin textarea').val('');//清空弹窗
		$('.xiugaizhongxin select').val('');//清空弹窗
		$('#noBtn').html('取消');
		$('#yesBtn').off().show();
		$('.xiugaizhongxin input').removeAttr('readonly').removeClass('readonly');//清空
		$('.xiugaizhongxin select').removeAttr('disabled').removeClass('readonly');//清空
	}	
	//显示新建窗口
	function shownewCenterSbox(){
		reloadSbox();//初始化弹窗
		$('.xiugaizhongxin .sbox_h4').html('添加银行');
		showSbox('.xiugaizhongxin');//显示弹窗
		$('#yesBtn').off().on('click',function(){centerFunc('new')});
	}
	//新建
	window.centerFunc = function(is,id){
		var is = is || '';
		var id = id || '';
		//var code = $('#code').val() || '';
		var name = $('#name').val() || '';
		var phone = $('#phone').val() || '';
		var uNumber = $('#unumber').val() || '';
		var initPassword = $('#initPassword').val() || '';
		var pta = $('#pta').val() || '';
		var openFee = $('#openFee').val() || '';
		var cipherFee = $('#cipherFee').val() || '';
		var uFee = $('#ufee').val() || '';
		var onlineBankFee = $('#onlineBankFee').val() || '';
		var accountFee = $('#accountFee').val() || '';
		var smsFee = $('#smsFee').val() || '';
		var remark = $('#remark').val() || '';
		//if(code == ''){Utils.alert('编号不能为空！');return false;}
		if(name == ''){Utils.alert('银行名称不能为空！');return false;}
		if(phone == ''){Utils.alert('银行电话不能为空！');return false;}
		if(uNumber == ''){Utils.alert('U盾数量不能为空！');return false;}
		if(initPassword == ''){Utils.alert('初始密码不能为空！');return false;}
		if(pta == ''){Utils.alert('公对公转账数额不能为空！');return false;}
		if(openFee == ''){Utils.alert('开户费不能为空！');return false;}
		if(cipherFee == ''){Utils.alert('密码器费用不能为空！');return false;}
		if(uFee == ''){Utils.alert('网银U盾费用不能为空！');return false;}
		if(onlineBankFee == ''){Utils.alert('网银年费不能为空！');return false;}
		if(accountFee == ''){Utils.alert('账户年费不能为空！');return false;}
		if(smsFee == ''){Utils.alert('短信提示年费不能为空！');return false;}
		//if(remark == ''){Utils.alert('备注不能为空！');return false;}
		$('#yesBtn').off();
		var condi = {};
		condi.parkId  = g.id;
		//condi.code  = code;
		condi.name  = name;
		condi.phone  = phone;
		condi.uNumber  = uNumber;
		condi.initPassword  = initPassword;
		condi.pta  = pta;
		condi.openFee  = openFee;
		condi.cipherFee  = cipherFee;
		condi.uFee  = uFee;
		condi.onlineBankFee  = onlineBankFee;
		condi.accountFee  = accountFee;
		condi.smsFee  = smsFee;
		condi.remark  = remark;
		var url = Base.serverUrl + "park/bank/create";
		if(is == 'change'){condi.id = id;url = Base.serverUrl + "park/bank/update";}
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"GET",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var tips = '新增成功！';
					if(is == 'change'){tips = '修改成功！';}
					Utils.alert(tips);
					tableListShow(2);//列表 
					closeSbox();//关闭弹窗
				}
				else{
					var msg = data.message || "获取信息失败";
					Utils.alert(msg);
				}
				$('#yesBtn').off().on('click',function(){centerFunc(is)});
			},
			error:function(data,status){
				//g.httpTip.hide();
				$('#yesBtn').off().on('click',function(){centerFunc(is)});
				if(status=='timeout'){
		　　　　　  //Utils.alert("超时");
		　　　　}
			}
		});
	}
	 
	//列表
	function tableListShow(is){
		var is = is || '';
		var condi = {};
		condi.parkId = g.id;
		condi.page = g.nowPage;//当前页
		condi.number = 1000;//g.showPages;//每页显示行数
		var url = Base.serverUrl + "park/bank/list";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var data = data.result || [];
					g.totalPage = data.totalPages || 0;//总页数
					var totalElements = data.totalElements || 0;//总共中心数
					//$('#totalElements').html(totalElements);
					var html = '';
					var sstr = '';
					html += '<table class="table1">'
						+'<tr>'
							+'<th style="min-width:26px;">编号</th>'
							+'<th style="min-width:65px;">开户行名称</th>'
							+'<th style="min-width:26px;">电话</th>'
							+'<th style="min-width:52px;">U盾数量</th>'
							+'<th style="min-width:52px;">初始密码</th>'
							+'<th style="min-width:65px;">公对公和公对私转账限额</th>'
							+'<th style="min-width:39px;">开户费</th>'
							+'<th style="min-width:65px;">密码器费用</th>'
							+'<th style="min-width:78px;">网银U盾费用</th>'
							+'<th style="min-width:52px;">网银年费</th>'
							+'<th style="min-width:52px;">账户年费</th>'
							+'<th style="min-width:78px;">短信提示年费</th>'
							+'<th style="min-width:26px;">备注</th>'
							+'<th style="min-width:152px;">操作</th>'
						+'</tr>';
					var con = data || [];
					for(var i=0,len=con.length;i<len;i++){
						var xu = len - i;
						var d = con[i] || '';
						var id = d.id || '';
						var code = d.code || '';
						var name = d.name || '';
						var phone = d.phone || '';
						var uNumber = d.unumber || '';
						var initPassword = d.initPassword || '';
						var openFee = d.openFee || '';
						var pta = d.pta || '';
						var cipherFee = d.cipherFee || '';
						var uFee = d.ufee || '';
						var onlineBankFee = d.onlineBankFee || '';
						var accountFee = d.accountFee || '';
						var smsFee = d.smsFee || '';
						var remark = d.remark || '';
						var task_plan_start_time = getDate((d.task_plan_start_time || ''),'2');
						html+='<tr>'
							+'<td>'+code+'</td>'
							+'<td>'+name+'</td>'
							+'<td>'+phone+'</td>'
							+'<td>'+uNumber+'</td>'
							+'<td>'+initPassword+'</td>'
							+'<td>'+pta+'</td>'
							+'<td>'+openFee+'</td>'
							+'<td>'+cipherFee+'</td>'
							+'<td>'+uFee+'</td>'
							+'<td>'+onlineBankFee+'</td>'
							+'<td>'+accountFee+'</td>'
							+'<td>'+smsFee+'</td>'
							+'<td>'+remark+'</td>'
							+'<td class="last">'
								+'<a href="javascript:;" onclick="review(\''+id+'\')" class="cao_btn cao_btn1">编辑</a>';
								html+='<a href="javascript:;" onclick="deleteIt(\''+id+'\')" class="cao_btn cao_btn3">删除</a>';
							html+='</td>'
						+'</tr>';
					}	
					 html+='</table>';
					$('#tableList').html(html);
					is_show('.xiangMu_renWuFaBu');
					//加载分页
					if(g.loadPage){
						setPages();//分页
						if($('#Pagination').html() == ''){//判断是否显示分页跳转等
							$('.pagesShow,.page-go,.gogo').hide();
						}else{
							$('.pagesShow,.page-go,.gogo').show();
						}
						g.loadPage = false;
					}
				}
				else{
					var msg = data.message || "获取项目信息失败";
					//Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  //Utils.alert("超时");
		　　　　}
			}
		});
	}
	
	//查看
	window.review = function(id){
		showOrChange(id,'change');
	}
	//查看或者修改的 公共方法
	window.showOrChange = function(id,is){
		var id = id || '';
		var is = is || '';
		if(id == ''){Utils.alert('id不能为空！');return false;}
		var condi = {};
		condi.id = id;
		var url = Base.serverUrl + "park/bank/edit";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"GET",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					var d = data.result || {};
					
					reloadSbox();//初始化弹窗
					//赋值
					//$('#code').val(d.code || '');
					$('#name').val(d.name || '');
					$('#phone').val(d.phone || '');
					$('#uNumber').val(d.unumber || '');
					$('#initPassword').val(d.initPassword || '');
					$('#pta').val(d.pta || '');
					$('#openFee').val(d.openFee || '');
					$('#cipherFee').val(d.cipherFee || '');
					$('#uFee').val(d.ufee || '');
					$('#onlineBankFee').val(d.onlineBankFee || '');
					$('#accountFee').val(d.accountFee || '');
					$('#smsFee').val(d.smsFee || '');
					$('#remark').val(d.remark || '');
					
					//弹窗
					var tips = '';//判断弹窗标题
					tips = '修改银行';
					$('#yesBtn').off().on('click',function(){centerFunc('change',d.id || '')});
					$('.xiugaizhongxin .sbox_h4').html(tips);
					showSbox('.xiugaizhongxin');//显示弹窗
				}
				else{
					var msg = data.message || "删除失败";
					Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  Utils.alert("超时");
		　　　　}
			}
		});
	}

		
	
	
	//删除一项
	window.deleteIt = function(id){
		var id = id || '';
		if(id == ''){Utils.alert('id不能为空！');return false;}
		if(!confirm('确认删除吗？')){return false;}
		var condi = {};
		condi.id = id;
		var url = Base.serverUrl + "park/bank/completeDelete";
		//g.httpTip.show();
		$.ajax({
			url:url,
			data:condi,
			timeout: 30000, //超时时间设置，单位毫秒
			type:"POST",
			xhrFields: {
				withCredentials: true
			},
			crossDomain: true,
			dataType:'json',
			context:this,
			success: function(data){
				var status = data.success || false;
				if(status){
					Utils.alert('删除成功！');
					tableListShow(2);//列表
				}
				else{
					var msg = data.message || "删除失败";
					Utils.alert(msg);
				}
				//g.httpTip.hide();
			},
			error:function(data,status){
				//g.httpTip.hide();
				if(status=='timeout'){
		　　　　　  Utils.alert("超时");
		　　　　}
			}
		});
	}
	
	
	//加载时间控件
	var start = {
	  elem: '#plantime',
	  format: 'YYYY-MM-DD',
	  //min: laydate.now(), //设定最小日期为当前日期
	  max: '2099-06-16', //最大日期
	  istime: true,
	  istoday: false,
	  choose: function(datas){
		 //end.min = datas; //开始日选好后，重置结束日的最小日期
		 //end.start = datas //将结束日的初始值设定为开始日
	  }
	};
	laydate(start);

	//定义时间
	window.cdate = {
	  format: 'YYYY-MM-DD',
	  //min: laydate.now(), //设定最小日期为当前日期
	  max: '2099-06-16', //最大日期
	  istime: true,
	  istoday: false,
	  choose: function(datas){
		 //end.min = datas; //开始日选好后，重置结束日的最小日期
		 //end.start = datas //将结束日的初始值设定为开始日
	  }
	};
	
	//设置每页显示多少行
	$('.pagesShow').change(function(){
		var num = $(this).val() || 10;
		g.nowPage = 0;//回到第一页
		g.showPages = num;
		g.loadPage = true;//设置页面加载 配置分页
		tableListShow();//显示列表
	});
	
	$(".gogo").on("click",function(){
    	var allPage = g.totalPage;
    	//console.log(allPage);
      var goPage = $(".page-go input").val() - 1; //跳转页数
      if(goPage > -1 && goPage <= allPage){
		g.nowPage = goPage;
		tableListShow();//显示列表
      }else {
      	Utils.alert('超出范围!');
      }
      //清空用户跳转页数
      //$(".page-go input").val("");
    });
	
	//分页
	function setPages(){
		$("#Pagination").pagination(g.totalPage,{
			callback: PageCallback, 
			 prev_text: '<',             
			 next_text: '>',
			 current_page:g.nowPage
		});
		$('.allPage').html(g.totalPage);
	}
	function PageCallback(index, jq){
		  g.nowPage = index || 0;
		  tableListShow('pa');//列表
	 }	
	
});

</script>
</html>